<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 6F1E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6F1A.html">6F1A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f1e">Map</a></td>
<td class="next">
Next: <a href="6F75.html">6F75</a>
</td>
</tr>
</table>
<div class="description">6F1E: Make ANGELFACE hit now and then</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this continual subcommand routine is placed into bytes 0x7C and 0x7D of ANGELFACE's buffer by command lists <a href="FC04.html">0x8E</a>, <a href="FC4B.html">0x96</a>, <a href="FC92.html">0x9E</a>, <a href="FCD9.html">0xA6</a>, <a href="FD11.html">0xAE</a>, <a href="FD39.html">0xB4</a> and <a href="FD49.html">0xB6</a>. It decides whether ANGELFACE should throw a punch, and gets the punching action under way if so.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">0xA8 (ANGELFACE)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f1e"></span>6F1E</td>
<td class="instruction">LD L,$70</td>
<td class="comment-1" rowspan="4">Return now if there is an uninterruptible subcommand routine address in bytes 0x6F and 0x70 of ANGELFACE's buffer (meaning he is currently occupied)</td>
</tr>
<tr>
<td class="address-1"><span id="6f20"></span>6F20</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="6f21"></span>6F21</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="6f22"></span>6F22</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="6f23"></span>6F23</td>
<td class="instruction">LD L,$60</td>
<td class="comment-1" rowspan="1">Byte 0x60 holds ANGELFACE's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="6f25"></span>6F25</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Is ANGELFACE midstride?</td>
</tr>
<tr>
<td class="address-1"><span id="6f27"></span>6F27</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="6f28"></span>6F28</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Byte 0x61 holds ANGELFACE's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f29"></span>6F29</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f2a"></span>6F2A</td>
<td class="instruction">CALL <a href="6648.html#6649">$6649</a></td>
<td class="comment-1" rowspan="1">Is ANGELFACE on a staircase?</td>
</tr>
<tr>
<td class="address-1"><span id="6f2d"></span>6F2D</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="6f2e"></span>6F2E</td>
<td class="instruction">CALL <a href="6E3C.html">$6E3C</a></td>
<td class="comment-1" rowspan="1">Can any teachers see ANGELFACE?</td>
</tr>
<tr>
<td class="address-1"><span id="6f31"></span>6F31</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f32"></span>
<div class="comments">
<div class="paragraph">
ANGELFACE is not on a staircase, and there are no teachers nearby. Are there any potential victims nearby?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="6f32"></span>6F32</td>
<td class="instruction">LD L,$62</td>
<td class="comment-1" rowspan="1">Byte 0x62 holds ANGELFACE's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f34"></span>6F34</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f35"></span>6F35</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="2">Pick up ANGELFACE's y-coordinate in <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f36"></span>6F36</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="6f37"></span>6F37</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0x60 (which byte holds ANGELFACE's animatory state)</td>
</tr>
<tr>
<td class="address-1"><span id="6f38"></span>6F38</td>
<td class="instruction">SUB $03</td>
<td class="comment-1" rowspan="4">Set <span class="register">A</span> equal to the 'target' x-coordinate (i.e. where a character would have to be in order to receive ANGELFACE's punch)</td>
</tr>
<tr>
<td class="address-1"><span id="6f3a"></span>6F3A</td>
<td class="instruction">BIT 7,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="6f3c"></span>6F3C</td>
<td class="instruction">JR Z,$6F40</td>
</tr>
<tr>
<td class="address-1"><span id="6f3e"></span>6F3E</td>
<td class="instruction">ADD A,$06</td>
</tr>
<tr>
<td class="address-2"><span id="6f40"></span>6F40</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Place the target x-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f41"></span>6F41</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=ANGELFACE's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="6f42"></span>6F42</td>
<td class="instruction">LD H,$AC</td>
<td class="comment-1" rowspan="1">0xAC=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="6f44"></span>6F44</td>
<td class="instruction">CALL <a href="6F00.html">$6F00</a></td>
<td class="comment-1" rowspan="1">Is ERIC a potential target?</td>
</tr>
<tr>
<td class="address-1"><span id="6f47"></span>6F47</td>
<td class="instruction">JR NC,$6F56</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="6f49"></span>6F49</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f4a"></span>
<div class="comments">
<div class="paragraph">
If we get here, there is a potential victim in front of ANGELFACE for him to take a swing at.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f4a"></span>6F4A</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Drop the return address (<a href="6226.html#6254">6254</a>) from the stack; this makes the character-moving routine at <a href="6226.html">6226</a> skip any further consideration of ANGELFACE on this pass, thus preventing him from moving midstride before throwing the punch</td>
</tr>
<tr>
<td class="address-1"><span id="6f4b"></span>6F4B</td>
<td class="instruction">LD HL,$A871</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0x71 of ANGELFACE's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="6f4e"></span>6F4E</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-1" rowspan="1">Store his current animatory state there</td>
</tr>
<tr>
<td class="address-1"><span id="6f4f"></span>6F4F</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="4">Place the address of the uninterruptible subcommand routine at <a href="6F80.html">6F80</a> (throw a punch) into bytes 0x6F and 0x70 of ANGELFACE's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="6f50"></span>6F50</td>
<td class="instruction">LD (HL),$6F</td>
</tr>
<tr>
<td class="address-1"><span id="6f52"></span>6F52</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="6f53"></span>6F53</td>
<td class="instruction">LD (HL),$80</td>
</tr>
<tr>
<td class="address-1"><span id="6f55"></span>6F55</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f56"></span>
<div class="comments">
<div class="paragraph">
ERIC is not a potential target for ANGELFACE's fist. What about the other main kids?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f56"></span>6F56</td>
<td class="instruction">LD H,$A9</td>
<td class="comment-1" rowspan="1">0xA9=EINSTEIN</td>
</tr>
<tr>
<td class="address-1"><span id="6f58"></span>6F58</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">There are three main kids</td>
</tr>
<tr>
<td class="address-2"><span id="6f5a"></span>6F5A</td>
<td class="instruction">CALL <a href="6F00.html">$6F00</a></td>
<td class="comment-1" rowspan="1">Is this main kid a potential target?</td>
</tr>
<tr>
<td class="address-1"><span id="6f5d"></span>6F5D</td>
<td class="instruction">JR NC,$6F61</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="6f5f"></span>6F5F</td>
<td class="instruction">JR $6F4A</td>
<td class="comment-1" rowspan="1">Otherwise throw a punch</td>
</tr>
<tr>
<td class="address-2"><span id="6f61"></span>6F61</td>
<td class="instruction">DEC H</td>
<td class="comment-1" rowspan="1">Next main kid</td>
</tr>
<tr>
<td class="address-1"><span id="6f62"></span>6F62</td>
<td class="instruction">DJNZ $6F5A</td>
<td class="comment-1" rowspan="1">Jump back until the three main kids have been checked</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f64"></span>
<div class="comments">
<div class="paragraph">
EINSTEIN and BOY WANDER weren't potential targets either. What about the little boys?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="6f64"></span>6F64</td>
<td class="instruction">LD H,$98</td>
<td class="comment-1" rowspan="1">0x98=little boy no. 1</td>
</tr>
<tr>
<td class="address-1"><span id="6f66"></span>6F66</td>
<td class="instruction">LD B,$07</td>
<td class="comment-1" rowspan="1">We check only the first seven little boys - <a href="../reference/facts.html#bullyFriends">interesting</a>!</td>
</tr>
<tr>
<td class="address-2"><span id="6f68"></span>6F68</td>
<td class="instruction">CALL <a href="6F00.html">$6F00</a></td>
<td class="comment-1" rowspan="1">Is this little boy a potential target?</td>
</tr>
<tr>
<td class="address-1"><span id="6f6b"></span>6F6B</td>
<td class="instruction">JR NC,$6F6F</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="6f6d"></span>6F6D</td>
<td class="instruction">JR $6F4A</td>
<td class="comment-1" rowspan="1">Otherwise throw a punch</td>
</tr>
<tr>
<td class="address-2"><span id="6f6f"></span>6F6F</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Next little boy</td>
</tr>
<tr>
<td class="address-1"><span id="6f70"></span>6F70</td>
<td class="instruction">DJNZ $6F68</td>
<td class="comment-1" rowspan="1">Jump back until the seven little boys have been checked</td>
</tr>
<tr>
<td class="address-1"><span id="6f72"></span>6F72</td>
<td class="instruction">LD H,$A8</td>
<td class="comment-1" rowspan="1">Restore ANGELFACE's character number to <span class="register">H</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f74"></span>6F74</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6F1A.html">6F1A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f1e">Map</a></td>
<td class="next">
Next: <a href="6F75.html">6F75</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20200809</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/28446.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>