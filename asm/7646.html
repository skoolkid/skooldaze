<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 7646</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="7644.html">7644</a>
</td>
<td class="up">Up: <a href="../maps/all.html#7646">Map</a></td>
<td class="next">
Next: <a href="76C6.html">76C6</a>
</td>
</tr>
</table>
<div class="description">7646: Generate graphic data for a number</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="76C8.html">76C8</a> and <a href="76E0.html">76E0</a>. Generates a 7x24-bit graphic for the digits of the number in <span class="register">DE</span>, and stores it in the buffer at <a href="D900.html#d90b">D90B</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Number</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="7646"></span>7646</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7647"></span>7647</td>
<td class="instruction">LD HL,$D91F</td>
<td class="comment-1" rowspan="6">Blank out the 32-byte buffer at <a href="D900.html">D900</a></td>
</tr>
<tr>
<td class="address-1"><span id="764a"></span>764A</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address-1"><span id="764b"></span>764B</td>
<td class="instruction">LD B,$1F</td>
</tr>
<tr>
<td class="address-2"><span id="764d"></span>764D</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="764e"></span>764E</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="764f"></span>764F</td>
<td class="instruction">DJNZ $764D</td>
</tr>
<tr>
<td class="address-1"><span id="7651"></span>7651</td>
<td class="instruction">LD A,$30</td>
<td class="comment-1" rowspan="1">0x30 is the ASCII code for '0' (zero)</td>
</tr>
<tr>
<td class="address-1"><span id="7653"></span>7653</td>
<td class="instruction">LD BC,$D8F0</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-10000</td>
</tr>
<tr>
<td class="address-1"><span id="7656"></span>7656</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=the number, <span class="register">DE</span>=<a href="D900.html">D900</a></td>
</tr>
<tr>
<td class="address-1"><span id="7657"></span>7657</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 10000</td>
</tr>
<tr>
<td class="address-1"><span id="7658"></span>7658</td>
<td class="instruction">JR C,$7675</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 10000</td>
</tr>
<tr>
<td class="address-1"><span id="765a"></span>765A</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 10000 back on</td>
</tr>
<tr>
<td class="address-1"><span id="765c"></span>765C</td>
<td class="instruction">LD BC,$FC18</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-1000</td>
</tr>
<tr>
<td class="address-1"><span id="765f"></span>765F</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 1000</td>
</tr>
<tr>
<td class="address-1"><span id="7660"></span>7660</td>
<td class="instruction">JR C,$7682</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 1000</td>
</tr>
<tr>
<td class="address-1"><span id="7662"></span>7662</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 1000 back on</td>
</tr>
<tr>
<td class="address-1"><span id="7664"></span>7664</td>
<td class="instruction">LD BC,$FF9C</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-100</td>
</tr>
<tr>
<td class="address-1"><span id="7667"></span>7667</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 100</td>
</tr>
<tr>
<td class="address-1"><span id="7668"></span>7668</td>
<td class="instruction">JR C,$768F</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 100</td>
</tr>
<tr>
<td class="address-1"><span id="766a"></span>766A</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 100 back on</td>
</tr>
<tr>
<td class="address-1"><span id="766c"></span>766C</td>
<td class="instruction">LD C,$F6</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-10</td>
</tr>
<tr>
<td class="address-1"><span id="766e"></span>766E</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 10</td>
</tr>
<tr>
<td class="address-1"><span id="766f"></span>766F</td>
<td class="instruction">JR C,$769B</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 10</td>
</tr>
<tr>
<td class="address-1"><span id="7671"></span>7671</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 10 back on</td>
</tr>
<tr>
<td class="address-1"><span id="7673"></span>7673</td>
<td class="instruction">JR $76A3</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7675"></span>
<div class="comments">
<div class="paragraph">
We get here if the number is &gt;= 10000.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="7675"></span>7675</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 10000 and get the ASCII code for the 10000s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="7676"></span>7676</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="7677"></span>7677</td>
<td class="instruction">JR C,$7675</td>
</tr>
<tr>
<td class="address-1"><span id="7679"></span>7679</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="767b"></span>767B</td>
<td class="instruction">LD BC,$FC18</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-1000</td>
</tr>
<tr>
<td class="address-1"><span id="767e"></span>767E</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 10000s digit</td>
</tr>
<tr>
<td class="address-1"><span id="767f"></span>767F</td>
<td class="instruction">LD A,$2F</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7681"></span>7681</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-2"><span id="7682"></span>7682</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 1000 and get the ASCII code for the 1000s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="7683"></span>7683</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="7684"></span>7684</td>
<td class="instruction">JR C,$7682</td>
</tr>
<tr>
<td class="address-1"><span id="7686"></span>7686</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="7688"></span>7688</td>
<td class="instruction">LD BC,$FF9C</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-100</td>
</tr>
<tr>
<td class="address-1"><span id="768b"></span>768B</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 1000s digit</td>
</tr>
<tr>
<td class="address-1"><span id="768c"></span>768C</td>
<td class="instruction">LD A,$2F</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="768e"></span>768E</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-2"><span id="768f"></span>768F</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 100 and get the ASCII code for the 100s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="7690"></span>7690</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="7691"></span>7691</td>
<td class="instruction">JR C,$768F</td>
</tr>
<tr>
<td class="address-1"><span id="7693"></span>7693</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="7695"></span>7695</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 100s digit</td>
</tr>
<tr>
<td class="address-1"><span id="7696"></span>7696</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="7697"></span>7697</td>
<td class="instruction">LD C,$F6</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-10</td>
</tr>
<tr>
<td class="address-1"><span id="7699"></span>7699</td>
<td class="instruction">LD A,$2F</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="769b"></span>769B</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 10 and get the ASCII code for the 10s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="769c"></span>769C</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="769d"></span>769D</td>
<td class="instruction">JR C,$769B</td>
</tr>
<tr>
<td class="address-1"><span id="769f"></span>769F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="76a1"></span>76A1</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 10s digit</td>
</tr>
<tr>
<td class="address-1"><span id="76a2"></span>76A2</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-2"><span id="76a3"></span>76A3</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="2">Get the ASCII code for the units digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="76a4"></span>76A4</td>
<td class="instruction">ADD A,$30</td>
</tr>
<tr>
<td class="address-1"><span id="76a6"></span>76A6</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the units digit</td>
</tr>
<tr>
<td class="address-1"><span id="76a7"></span>76A7</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="76a8"></span>76A8</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="76a9"></span>76A9</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Mark the end of the number string with a 0 byte</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="76aa"></span>
<div class="comments">
<div class="paragraph">
Now that the ASCII codes for the digits of the number have been calculated and stored at <a href="D900.html">D900</a>, generate the corresponding graphic data.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="76aa"></span>76AA</td>
<td class="instruction">LD E,$00</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="D900.html">D900</a> (first character in the number string)</td>
</tr>
<tr>
<td class="address-2"><span id="76ac"></span>76AC</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a character from the number string</td>
</tr>
<tr>
<td class="address-1"><span id="76ad"></span>76AD</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Have we reached the end of the string?</td>
</tr>
<tr>
<td class="address-1"><span id="76ae"></span>76AE</td>
<td class="instruction">JR NZ,$76B2</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="76b0"></span>76B0</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="76b1"></span>76B1</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="76b2"></span>76B2</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move to the next character in the number string</td>
</tr>
<tr>
<td class="address-1"><span id="76b3"></span>76B3</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="76b4"></span>76B4</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L'</span>=ASCII code for a digit of the number (0x30-0x39)</td>
</tr>
<tr>
<td class="address-1"><span id="76b5"></span>76B5</td>
<td class="instruction">LD H,$D9</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at the start of the font data for this digit</td>
</tr>
<tr>
<td class="address-1"><span id="76b7"></span>76B7</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the pixel width in <span class="register">B'</span></td>
</tr>
<tr>
<td class="address-1"><span id="76b8"></span>76B8</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Add 1 for left padding</td>
</tr>
<tr>
<td class="address-1"><span id="76b9"></span>76B9</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">An empty byte for left padding</td>
</tr>
<tr>
<td class="address-2"><span id="76ba"></span>76BA</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at the next bitmap byte</td>
</tr>
<tr>
<td class="address-1"><span id="76bb"></span>76BB</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="76bc"></span>76BC</td>
<td class="instruction">CALL <a href="7632.html">$7632</a></td>
<td class="comment-1" rowspan="1">Slide the bitmap byte into the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="76bf"></span>76BF</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="76c0"></span>76C0</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the next bitmap byte</td>
</tr>
<tr>
<td class="address-1"><span id="76c1"></span>76C1</td>
<td class="instruction">DJNZ $76BA</td>
<td class="comment-1" rowspan="1">Jump back until all bitmap bytes are done</td>
</tr>
<tr>
<td class="address-1"><span id="76c3"></span>76C3</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="76c4"></span>76C4</td>
<td class="instruction">JR $76AC</td>
<td class="comment-1" rowspan="1">Jump back to collect the next digit</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="7644.html">7644</a>
</td>
<td class="up">Up: <a href="../maps/all.html#7646">Map</a></td>
<td class="next">
Next: <a href="76C6.html">76C6</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../dec/asm/30278.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>