<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 6F99</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6F8E.html">6F8E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f99">Map</a></td>
<td class="next">
Next: <a href="6FE2.html">6FE2</a>
</td>
</tr>
</table>
<div class="description">6F99: Check whether anyone was punched by ERIC or ANGELFACE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from <a href="6F8E.html">6F8E</a>. Also used by the routine at <a href="F4A4.html">F4A4</a>. Checks whether anyone was punched by ERIC or ANGELFACE, and knocks them out if so.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">0xA8 (ANGELFACE) or 0xAC (ERIC)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f99"></span>6F99</td>
<td class="instruction">LD L,$62</td>
<td class="comment-1" rowspan="1">Byte 0x62 of the puncher's buffer holds his x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f9b"></span>6F9B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f9c"></span>6F9C</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0x61</td>
</tr>
<tr>
<td class="address-1"><span id="6f9d"></span>6F9D</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the puncher's y-coordinate in <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="6f9e"></span>6F9E</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0x60</td>
</tr>
<tr>
<td class="address-1"><span id="6f9f"></span>6F9F</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the puncher's animatory state in <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="6fa0"></span>6FA0</td>
<td class="instruction">SUB $02</td>
<td class="comment-1" rowspan="4"><span class="register">A</span>=x-coordinate of the location two spaces in front of the puncher</td>
</tr>
<tr>
<td class="address-1"><span id="6fa2"></span>6FA2</td>
<td class="instruction">BIT 7,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="6fa4"></span>6FA4</td>
<td class="instruction">JR Z,$6FA8</td>
</tr>
<tr>
<td class="address-1"><span id="6fa6"></span>6FA6</td>
<td class="instruction">ADD A,$04</td>
</tr>
<tr>
<td class="address-2"><span id="6fa8"></span>6FA8</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Store the potential victim's x-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="6fa9"></span>6FA9</td>
<td class="instruction">LD A,($7FFB)</td>
<td class="comment-1" rowspan="1">Collect ERIC's status flags from <a href="7FFB.html">7FFB</a></td>
</tr>
<tr>
<td class="address-1"><span id="6fac"></span>6FAC</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is ERIC doing the punching?</td>
</tr>
<tr>
<td class="address-1"><span id="6fad"></span>6FAD</td>
<td class="instruction">JR NZ,$6FBE</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="6faf"></span>6FAF</td>
<td class="instruction">LD H,$AC</td>
<td class="comment-1" rowspan="1">0xAC=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="6fb1"></span>6FB1</td>
<td class="instruction">CALL <a href="6F00.html">$6F00</a></td>
<td class="comment-1" rowspan="1">Was ERIC punched?</td>
</tr>
<tr>
<td class="address-1"><span id="6fb4"></span>6FB4</td>
<td class="instruction">JR NC,$6FBE</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="6fb6"></span>6FB6</td>
<td class="instruction">LD DE,$7FFB</td>
<td class="comment-1" rowspan="1"><a href="7FFB.html">7FFB</a> holds ERIC's status flags</td>
</tr>
<tr>
<td class="address-1"><span id="6fb9"></span>6FB9</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="6fba"></span>6FBA</td>
<td class="instruction">SET 4,(HL)</td>
<td class="comment-1" rowspan="1">Signal: ERIC was hit</td>
</tr>
<tr>
<td class="address-1"><span id="6fbc"></span>6FBC</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="6fbd"></span>6FBD</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6fbe"></span>
<div class="comments">
<div class="paragraph">
Now we check whether anyone was punched. We start with the three main kids.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6fbe"></span>6FBE</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">There are three main kids</td>
</tr>
<tr>
<td class="address-1"><span id="6fc0"></span>6FC0</td>
<td class="instruction">LD H,$A9</td>
<td class="comment-1" rowspan="1">0xA9=EINSTEIN</td>
</tr>
<tr>
<td class="address-2"><span id="6fc2"></span>6FC2</td>
<td class="instruction">CALL <a href="6F00.html">$6F00</a></td>
<td class="comment-1" rowspan="1">Was this main kid punched?</td>
</tr>
<tr>
<td class="address-1"><span id="6fc5"></span>6FC5</td>
<td class="instruction">JR NC,$6FD2</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-2"><span id="6fc7"></span>6FC7</td>
<td class="instruction">LD L,$6F</td>
<td class="comment-1" rowspan="4">Place the address of the uninterruptible subcommand routine at <a href="6A46.html">6A46</a> into bytes 0x6F and 0x70 of the victim's character buffer</td>
</tr>
<tr>
<td class="address-1"><span id="6fc9"></span>6FC9</td>
<td class="instruction">LD (HL),$46</td>
</tr>
<tr>
<td class="address-1"><span id="6fcb"></span>6FCB</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="6fcc"></span>6FCC</td>
<td class="instruction">LD (HL),$6A</td>
</tr>
<tr>
<td class="address-1"><span id="6fce"></span>6FCE</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Initialise the parameter determining how long the character will stay down (in byte 0x71)</td>
</tr>
<tr>
<td class="address-1"><span id="6fcf"></span>6FCF</td>
<td class="instruction">LD (HL),$14</td>
</tr>
<tr>
<td class="address-1"><span id="6fd1"></span>6FD1</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="6fd2"></span>6FD2</td>
<td class="instruction">DEC H</td>
<td class="comment-1" rowspan="1">Next main kid</td>
</tr>
<tr>
<td class="address-1"><span id="6fd3"></span>6FD3</td>
<td class="instruction">DJNZ $6FC2</td>
<td class="comment-1" rowspan="1">Jump back until three main kids have been considered</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6fd5"></span>
<div class="comments">
<div class="paragraph">
None of the main kids was hit. What about the little boys?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="6fd5"></span>6FD5</td>
<td class="instruction">LD H,$98</td>
<td class="comment-1" rowspan="1">0x98=character number of little boy no. 1</td>
</tr>
<tr>
<td class="address-1"><span id="6fd7"></span>6FD7</td>
<td class="instruction">LD B,$0B</td>
<td class="comment-1" rowspan="1">There are 11 little boys</td>
</tr>
<tr>
<td class="address-2"><span id="6fd9"></span>6FD9</td>
<td class="instruction">CALL <a href="6F00.html">$6F00</a></td>
<td class="comment-1" rowspan="1">Was this little boy hit?</td>
</tr>
<tr>
<td class="address-1"><span id="6fdc"></span>6FDC</td>
<td class="instruction">JR C,$6FC7</td>
<td class="comment-1" rowspan="1">Knock him over if so</td>
</tr>
<tr>
<td class="address-1"><span id="6fde"></span>6FDE</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Next little boy</td>
</tr>
<tr>
<td class="address-1"><span id="6fdf"></span>6FDF</td>
<td class="instruction">DJNZ $6FD9</td>
<td class="comment-1" rowspan="1">Jump back until all 11 little boys have been considered</td>
</tr>
<tr>
<td class="address-1"><span id="6fe1"></span>6FE1</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6F8E.html">6F8E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f99">Map</a></td>
<td class="next">
Next: <a href="6FE2.html">6FE2</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../dec/asm/28569.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>