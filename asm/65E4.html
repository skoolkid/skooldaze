<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 65E4</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="65DB.html">65DB</a></span></td>
<td class="up">Up: <a href="../maps/all.html#65e4">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="663F.html">663F</a></span></td>
</tr>
</table>
<div class="description">65E4: 'Q' pressed - up</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this routine is found in the table of keypress handling routines at <a href="6800.html">6800</a>. It is called from the main loop at <a href="6767.html">6767</a> when 'Q' or '7' is pressed, and is also used by the routines at <a href="6652.html">6652</a> and <a href="66AA.html">66AA</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">ERIC's animatory state</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">ERIC's coordinates</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="65e4"></span>65E4</td>
<td class="instruction">CALL <a href="6564.html">$6564</a></td>
<td class="comment-11" rowspan="1">Is ERIC sitting or lying down?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65e7"></span>65E7</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65e8"></span>65E8</td>
<td class="instruction">BIT 6,A</td>
<td class="comment-11" rowspan="2">Bit 6 of ERIC's status flags at <a href="7FFB.html">7FFB</a> is always reset, so this jump is never made</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65ea"></span>65EA</td>
<td class="instruction">JR NZ,<a href="657F.html#65d3">$65D3</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65ec"></span>65EC</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65ed"></span>65ED</td>
<td class="instruction">CP $9B</td>
<td class="comment-11" rowspan="1">Is ERIC on the top floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65ef"></span>65EF</td>
<td class="instruction">JR Z,<a href="657F.html#65d3">$65D3</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65f1"></span>65F1</td>
<td class="instruction">CP $A2</td>
<td class="comment-11" rowspan="1">Is ERIC on the middle floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65f3"></span>65F3</td>
<td class="instruction">JR Z,$6623</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65f5"></span>65F5</td>
<td class="instruction">CP $A9</td>
<td class="comment-11" rowspan="1">Is ERIC on the bottom floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65f7"></span>65F7</td>
<td class="instruction">JR Z,$6623</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="65f9"></span>
<div class="comments">
<div class="paragraph">
ERIC's not on the top, middle or bottom floor, so he must be on a staircase. Should he go up a step, or turn round first?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65f9"></span>65F9</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65fa"></span>65FA</td>
<td class="instruction">CP $30</td>
<td class="comment-11" rowspan="1">Set the carry flag if ERIC's on a staircase at the left of the skool</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65fc"></span>65FC</td>
<td class="instruction">BIT 7,B</td>
<td class="comment-11" rowspan="1">Set the zero flag if ERIC is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="65fe"></span>65FE</td>
<td class="instruction">JR C,$6605</td>
<td class="comment-11" rowspan="1">Jump if ERIC's on a staircase at the left of the skool</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6600"></span>6600</td>
<td class="instruction">JP Z,<a href="656A.html">$656A</a></td>
<td class="comment-11" rowspan="1">Turn ERIC round if he's facing down a staircase at the right of the skool</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6603"></span>6603</td>
<td class="instruction">JR $6608</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6605"></span>6605</td>
<td class="instruction">JP NZ,<a href="656A.html">$656A</a></td>
<td class="comment-11" rowspan="1">Turn ERIC round if he's facing down a staircase at the left of the skool</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="6608"></span>
<div class="comments">
<div class="paragraph">
ERIC's at the bottom of or on a staircase, facing the top of it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6608"></span>6608</td>
<td class="instruction">DEC D</td>
<td class="comment-11" rowspan="1">Up a step</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6609"></span>6609</td>
<td class="instruction">LD H,D</td>
<td class="comment-11" rowspan="2">Copy ERIC's next coordinates to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="660a"></span>660A</td>
<td class="instruction">LD L,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="660b"></span>660B</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1">One pace to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="660c"></span>660C</td>
<td class="instruction">LD B,$02</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#2">2</a>=ERIC standing, facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="660e"></span>660E</td>
<td class="instruction">CP $30</td>
<td class="comment-11" rowspan="1">Is ERIC on a staircase on the left side of the skool?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6610"></span>6610</td>
<td class="instruction">JR C,$6616</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6612"></span>6612</td>
<td class="instruction">LD B,$82</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#130">130</a>=ERIC standing, facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6614"></span>6614</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="2">One pace to the right (taking into the account the one pace to the left made above)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6615"></span>6615</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6616"></span>6616</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a href="../graphics/as.html#2">2/130</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6617"></span>6617</td>
<td class="instruction">BIT 0,L</td>
<td class="comment-11" rowspan="6"><span class="register">A</span>=<a href="../graphics/as.html#3">3/131</a>, <span class="register">B</span>=<a href="../graphics/as.html#2">2/130</a> if ERIC's current x-coordinate is even (which is a <a href="../reference/bugs.html#oneFourThreeFour">bug</a>); <span class="register">A</span>=<a href="../graphics/as.html#3">3/131</a>, <span class="register">B</span>=<a href="../graphics/as.html#0">0/128</a> if ERIC's current x-coordinate is odd</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6619"></span>6619</td>
<td class="instruction">JR Z,$661D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="661b"></span>661B</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="661c"></span>661C</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="661d"></span>661D</td>
<td class="instruction">ADD A,$02</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="661f"></span>661F</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6620"></span>6620</td>
<td class="instruction">JP <a href="653C.html">$653C</a></td>
<td class="comment-11" rowspan="1">Update ERIC's animatory state and location</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="6623"></span>
<div class="comments">
<div class="paragraph">
ERIC is on the middle floor or the top floor.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6623"></span>6623</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6624"></span>6624</td>
<td class="instruction">CP $13</td>
<td class="comment-11" rowspan="1">19=x-coordinate of the bottoms of the staircases at the left of the skool</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6626"></span>6626</td>
<td class="instruction">JR NZ,$662F</td>
<td class="comment-11" rowspan="1">Jump unless ERIC is here</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6628"></span>6628</td>
<td class="instruction">BIT 7,B</td>
<td class="comment-11" rowspan="1">Is ERIC facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="662a"></span>662A</td>
<td class="instruction">JP NZ,<a href="66AA.html">$66AA</a></td>
<td class="comment-11" rowspan="1">Move ERIC right if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="662d"></span>662D</td>
<td class="instruction">JR $6608</td>
<td class="comment-11" rowspan="1">Otherwise send ERIC up a step</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="662f"></span>662F</td>
<td class="instruction">CP $46</td>
<td class="comment-11" rowspan="1">70=x-coordinate of the bottoms of the staircases at the right of the skool</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6631"></span>6631</td>
<td class="instruction">JR NZ,$6637</td>
<td class="comment-11" rowspan="1">Jump unless ERIC is here</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6633"></span>6633</td>
<td class="instruction">BIT 7,B</td>
<td class="comment-11" rowspan="1">Is ERIC facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6635"></span>6635</td>
<td class="instruction">JR NZ,$6608</td>
<td class="comment-11" rowspan="1">Send ERIC up a step if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6637"></span>6637</td>
<td class="instruction">BIT 7,B</td>
<td class="comment-11" rowspan="1">Is ERIC facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6639"></span>6639</td>
<td class="instruction">JP Z,<a href="6652.html">$6652</a></td>
<td class="comment-11" rowspan="1">Move ERIC left if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="663c"></span>663C</td>
<td class="instruction">JP <a href="66AA.html">$66AA</a></td>
<td class="comment-11" rowspan="1">Otherwise move ERIC right</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="65DB.html">65DB</a></span></td>
<td class="up">Up: <a href="../maps/all.html#65e4">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="663F.html">663F</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20151011</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd (Skool Daze). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.1.</div>
</footer>
</body>
</html>