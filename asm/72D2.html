<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 72D2</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="72C9.html">72C9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#72d2">Map</a></td>
<td class="next">
Next: <a href="7301.html">7301</a>
</td>
</tr>
</table>
<div class="description">72D2: Update the SRB for the middle six columns of the speech bubble</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="7432.html">7432</a> and <a href="F4FA.html">F4FA</a>. Returns with the carry flag set if the speech bubble is off-screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="72d2"></span>72D2</td>
<td class="instruction">LD DE,($7F64)</td>
<td class="comment-1" rowspan="1">Copy the speech bubble lip coordinates from <a href="7F64.html">7F64</a> to <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="72d6"></span>72D6</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Now <span class="register">E</span> holds the x-coordinate of the left edge of the speech bubble</td>
</tr>
<tr>
<td class="address-1"><span id="72d7"></span>72D7</td>
<td class="instruction">AND $F8</td>
</tr>
<tr>
<td class="address-1"><span id="72d9"></span>72D9</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="72da"></span>72DA</td>
<td class="instruction">LD A,($7F00)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=leftmost column of the skool on screen (0-64)</td>
</tr>
<tr>
<td class="address-1"><span id="72dd"></span>72DD</td>
<td class="instruction">SUB E</td>
<td class="comment-1" rowspan="1">Is the speech bubble at the far left of the screen?</td>
</tr>
<tr>
<td class="address-1"><span id="72de"></span>72DE</td>
<td class="instruction">JR Z,$72EA</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="72e0"></span>72E0</td>
<td class="instruction">CCF</td>
<td class="comment-1" rowspan="2">Return with the carry flag set if the speech bubble is off-screen to the left</td>
</tr>
<tr>
<td class="address-1"><span id="72e1"></span>72E1</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="address-1"><span id="72e2"></span>72E2</td>
<td class="instruction">CP $E1</td>
<td class="comment-1" rowspan="2">Return with the carry flag set if the speech bubble is off-screen to the right</td>
</tr>
<tr>
<td class="address-1"><span id="72e4"></span>72E4</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="address-1"><span id="72e5"></span>72E5</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="4"><span class="register">A</span>=1, 2 or 3 (corresponding to the quadrant of the screen containing the speech bubble)</td>
</tr>
<tr>
<td class="address-1"><span id="72e7"></span>72E7</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="72e8"></span>72E8</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="72e9"></span>72E9</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-2"><span id="72ea"></span>72EA</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=0-3 (quadrant of the screen containing the speech bubble)</td>
</tr>
<tr>
<td class="address-1"><span id="72eb"></span>72EB</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="7">Point <span class="register">DE</span> at the byte of the screen refresh buffer corresponding to the top row of the speech bubble</td>
</tr>
<tr>
<td class="address-1"><span id="72ec"></span>72EC</td>
<td class="instruction">SUB $97</td>
</tr>
<tr>
<td class="address-1"><span id="72ee"></span>72EE</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="72ef"></span>72EF</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="72f0"></span>72F0</td>
<td class="instruction">ADD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="72f1"></span>72F1</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="72f2"></span>72F2</td>
<td class="instruction">LD D,$7F</td>
</tr>
<tr>
<td class="address-1"><span id="72f4"></span>72F4</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="3">Set bits 1-6 of this screen refresh buffer byte (so that the part of the screen hidden by the middle 6 UDGs of the top row of the speech bubble will be refreshed)</td>
</tr>
<tr>
<td class="address-1"><span id="72f5"></span>72F5</td>
<td class="instruction">OR $7E</td>
</tr>
<tr>
<td class="address-1"><span id="72f7"></span>72F7</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="72f8"></span>72F8</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Point <span class="register">DE</span> at the byte of the screen refresh buffer corresponding to the bottom row of the speech bubble</td>
</tr>
<tr>
<td class="address-1"><span id="72f9"></span>72F9</td>
<td class="instruction">ADD A,$04</td>
</tr>
<tr>
<td class="address-1"><span id="72fb"></span>72FB</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="72fc"></span>72FC</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="3">Set bits 1-6 of this screen refresh buffer byte (so that the part of the screen hidden by the middle 6 UDGS of the bottom row of the speech bubble will be refreshed)</td>
</tr>
<tr>
<td class="address-1"><span id="72fd"></span>72FD</td>
<td class="instruction">OR $7E</td>
</tr>
<tr>
<td class="address-1"><span id="72ff"></span>72FF</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="7300"></span>7300</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return with the carry flag reset</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="72C9.html">72C9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#72d2">Map</a></td>
<td class="next">
Next: <a href="7301.html">7301</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../dec/asm/29394.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>