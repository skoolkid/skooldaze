<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at F726</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F70A.html">F70A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f726">Map</a></td>
<td class="next">
Next: <a href="F772.html">F772</a>
</td>
</tr>
</table>
<div class="description">F726: Check whether ERIC has jumped up to the safe or a shield (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from <a href="F51E.html">F51E</a>. Checks whether ERIC has jumped up to the safe or a shield, and makes it flash or unflash as appropriate.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Coordinates of ERIC's hand</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="f726"></span>F726</td>
<td class="instruction">LD A,($7FEA)</td>
<td class="comment-1" rowspan="1">Pick up the game mode indicator from <a href="7FEA.html">7FEA</a></td>
</tr>
<tr>
<td class="address-1"><span id="f729"></span>F729</td>
<td class="instruction">CP $02</td>
<td class="comment-1" rowspan="1">Are all the shields flashing?</td>
</tr>
<tr>
<td class="address-1"><span id="f72b"></span>F72B</td>
<td class="instruction">JP NZ,<a href="6DC6.html#6de2">$6DE2</a></td>
<td class="comment-1" rowspan="1">Jump if not (to check whether ERIC touched a shield)</td>
</tr>
<tr>
<td class="address-1"><span id="f72e"></span>F72E</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=y-coordinate of ERIC's hand</td>
</tr>
<tr>
<td class="address-1"><span id="f72f"></span>F72F</td>
<td class="instruction">CP $A1</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the spot just under the safe in the staff room</td>
</tr>
<tr>
<td class="address-1"><span id="f731"></span>F731</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if ERIC is not on the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="f732"></span>F732</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x-coordinate of ERIC's hand</td>
</tr>
<tr>
<td class="address-1"><span id="f733"></span>F733</td>
<td class="instruction">CP $0A</td>
<td class="comment-1" rowspan="1">Has ERIC jumped up to the safe?</td>
</tr>
<tr>
<td class="address-1"><span id="f735"></span>F735</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f736"></span>
<div class="comments">
<div class="paragraph">
ERIC has jumped up to the safe. Can he open it?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="f736"></span>F736</td>
<td class="instruction">LD HL,$7FED</td>
<td class="comment-1" rowspan="1"><a href="7FED.html">7FED</a> holds the number of the character who last wrote on the Reading Room blackboard</td>
</tr>
<tr>
<td class="address-1"><span id="f739"></span>F739</td>
<td class="instruction">LD DE,$7FA8</td>
<td class="comment-1" rowspan="1"><a href="7FA8.html">7FA8</a>=Reading Room blackboard contents buffer</td>
</tr>
<tr>
<td class="address-1"><span id="f73c"></span>F73C</td>
<td class="instruction">LD C,$03</td>
<td class="comment-1" rowspan="1">There are 3 blackboards</td>
</tr>
<tr>
<td class="address-2"><span id="f73e"></span>F73E</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=number of the character who last wrote on this board</td>
</tr>
<tr>
<td class="address-1"><span id="f73f"></span>F73F</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move <span class="register">HL</span> along to the next blackboard</td>
</tr>
<tr>
<td class="address-1"><span id="f740"></span>F740</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="f741"></span>F741</td>
<td class="instruction">CP $AC</td>
<td class="comment-1" rowspan="1">Did ERIC write on this blackboard?</td>
</tr>
<tr>
<td class="address-1"><span id="f743"></span>F743</td>
<td class="instruction">JR NZ,$F75A</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f745"></span>
<div class="comments">
<div class="paragraph">
ERIC wrote on this blackboard. Check whether he wrote the safe combination code.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="f745"></span>F745</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="f746"></span>F746</td>
<td class="instruction">LD L,$9F</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7F9F.html">7F9F</a> (which holds the safe combination code)</td>
</tr>
<tr>
<td class="address-1"><span id="f748"></span>F748</td>
<td class="instruction">LD B,$04</td>
<td class="comment-1" rowspan="1">There are 4 characters in the safe combination code</td>
</tr>
<tr>
<td class="address-1"><span id="f74a"></span>F74A</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save the pointer to the blackboard contents buffer</td>
</tr>
<tr>
<td class="address-2"><span id="f74b"></span>F74B</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character written on the blackboard by ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="f74c"></span>F74C</td>
<td class="instruction">AND $5F</td>
<td class="comment-1" rowspan="1">Convert to upper case</td>
</tr>
<tr>
<td class="address-1"><span id="f74e"></span>F74E</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move <span class="register">DE</span> along to the next character on the blackboard</td>
</tr>
<tr>
<td class="address-1"><span id="f74f"></span>F74F</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Does the character on the blackboard match a safe combination letter?</td>
</tr>
<tr>
<td class="address-1"><span id="f750"></span>F750</td>
<td class="instruction">JR NZ,$F756</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="f752"></span>F752</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Move to the next letter of the safe combination code</td>
</tr>
<tr>
<td class="address-1"><span id="f753"></span>F753</td>
<td class="instruction">DJNZ $F74B</td>
<td class="comment-1" rowspan="1">Jump back until all four letters have been checked</td>
</tr>
<tr>
<td class="address-1"><span id="f755"></span>F755</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Set the zero flag to indicate a match</td>
</tr>
<tr>
<td class="address-2"><span id="f756"></span>F756</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the blackboard contents buffer pointer to <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="f757"></span>F757</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="f758"></span>F758</td>
<td class="instruction">JR Z,$F762</td>
<td class="comment-1" rowspan="1">Jump if ERIC got the right combination</td>
</tr>
<tr>
<td class="address-2"><span id="f75a"></span>F75A</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Point <span class="register">DE</span> at the next blackboard contents buffer (<a href="7FAE.html">7FAE</a> or <a href="7FB4.html">7FB4</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="f75b"></span>F75B</td>
<td class="instruction">ADD A,$06</td>
</tr>
<tr>
<td class="address-1"><span id="f75d"></span>F75D</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="f75e"></span>F75E</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Decrease the blackboard counter</td>
</tr>
<tr>
<td class="address-1"><span id="f75f"></span>F75F</td>
<td class="instruction">JR NZ,$F73E</td>
<td class="comment-1" rowspan="1">Jump back until all three blackboards have been checked</td>
</tr>
<tr>
<td class="address-1"><span id="f761"></span>F761</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f762"></span>
<div class="comments">
<div class="paragraph">
ERIC got the right combination.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="f762"></span>F762</td>
<td class="instruction">CALL <a href="F8B4.html">$F8B4</a></td>
<td class="comment-1" rowspan="1">Add 1000 to the score and play a celebratory tune</td>
</tr>
<tr>
<td class="address-1"><span id="f765"></span>F765</td>
<td class="instruction">LD HL,$A18A</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the attribute byte for the safe</td>
</tr>
<tr>
<td class="address-1"><span id="f768"></span>F768</td>
<td class="instruction">SET 7,(HL)</td>
<td class="comment-1" rowspan="1">Alter the attribute byte of the safe in the skool attribute data to make it flash</td>
</tr>
<tr>
<td class="address-1"><span id="f76a"></span>F76A</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the attribute byte for the safe</td>
</tr>
<tr>
<td class="address-1"><span id="f76b"></span>F76B</td>
<td class="instruction">CALL <a href="F4D2.html">$F4D2</a></td>
<td class="comment-1" rowspan="1">Get the attribute file address of the safe in <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="f76e"></span>F76E</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return if the safe is off-screen (unlikely!)</td>
</tr>
<tr>
<td class="address-1"><span id="f76f"></span>F76F</td>
<td class="instruction">SET 7,(HL)</td>
<td class="comment-1" rowspan="1">Adjust the on-screen attribute byte of the safe to make it flash</td>
</tr>
<tr>
<td class="address-1"><span id="f771"></span>F771</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F70A.html">F70A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f726">Map</a></td>
<td class="next">
Next: <a href="F772.html">F772</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20200809</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/63270.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>