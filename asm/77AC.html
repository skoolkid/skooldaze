<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 77AC</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="77A6.html">77A6</a>
</td>
<td class="up">Up: <a href="../maps/all.html#77ac">Map</a></td>
<td class="next">
Next: <a href="78A8.html">78A8</a>
</td>
</tr>
</table>
<div class="description">77AC: Make any nearby teacher give ERIC lines if necessary</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="6AD9.html">6AD9</a>. Checks whether ERIC is somewhere he shouldn't be, or sitting or standing when or where he shouldn't be, or lying down, and makes any nearby teacher give lines accordingly.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="77ac"></span>77AC</td>
<td class="instruction">LD HL,$7FF2</td>
<td class="comment-1" rowspan="7">Check (and decrement) the lines-giving delay counter at <a href="7FF2.html">7FF2</a>, and proceed only if it was &lt;0x4B (the counter starts off at 0 for a new game, and is set to 0x96 by this routine after ERIC has been given lines)</td>
</tr>
<tr>
<td class="address-1"><span id="77af"></span>77AF</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="77b0"></span>77B0</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="77b1"></span>77B1</td>
<td class="instruction">JR Z,$77B7</td>
</tr>
<tr>
<td class="address-1"><span id="77b3"></span>77B3</td>
<td class="instruction">DEC (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="77b4"></span>77B4</td>
<td class="instruction">CP $4B</td>
</tr>
<tr>
<td class="address-1"><span id="77b6"></span>77B6</td>
<td class="instruction">RET NC</td>
</tr>
<tr>
<td class="address-2"><span id="77b7"></span>77B7</td>
<td class="instruction">LD BC,($AC61)</td>
<td class="comment-1" rowspan="1">Collect ERIC's coordinates in <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="77bb"></span>77BB</td>
<td class="instruction">LD L,$FB</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7FFB.html">7FFB</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="77bd"></span>77BD</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Is ERIC jumping?</td>
</tr>
<tr>
<td class="address-1"><span id="77bf"></span>77BF</td>
<td class="instruction">JR Z,$77D0</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="77c1"></span>77C1</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="77c2"></span>77C2</td>
<td class="instruction">LD C,$9B</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the top floor</td>
</tr>
<tr>
<td class="address-1"><span id="77c4"></span>77C4</td>
<td class="instruction">CP $9C</td>
<td class="comment-1" rowspan="1">Is ERIC on the top floor?</td>
</tr>
<tr>
<td class="address-1"><span id="77c6"></span>77C6</td>
<td class="instruction">JR C,$77D0</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="77c8"></span>77C8</td>
<td class="instruction">LD C,$A2</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="77ca"></span>77CA</td>
<td class="instruction">CP $A3</td>
<td class="comment-1" rowspan="1">Is ERIC on the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="77cc"></span>77CC</td>
<td class="instruction">JR C,$77D0</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="77ce"></span>77CE</td>
<td class="instruction">LD C,$A9</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the bottom floor</td>
</tr>
<tr>
<td class="address-2"><span id="77d0"></span>77D0</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate (adjusted if he's jumping)</td>
</tr>
<tr>
<td class="address-1"><span id="77d1"></span>77D1</td>
<td class="instruction">LD DE,$7790</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the skool region data table for the top floor at <a href="7790.html">7790</a></td>
</tr>
<tr>
<td class="address-1"><span id="77d4"></span>77D4</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="77d5"></span>77D5</td>
<td class="instruction">CP $9B</td>
<td class="comment-1" rowspan="1">Is ERIC on the top floor?</td>
</tr>
<tr>
<td class="address-1"><span id="77d7"></span>77D7</td>
<td class="instruction">JR Z,$77F0</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="77d9"></span>77D9</td>
<td class="instruction">LD L,$9C</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="779C.html">779C</a> (skool region data table for the middle floor)</td>
</tr>
<tr>
<td class="address-1"><span id="77db"></span>77DB</td>
<td class="instruction">CP $A2</td>
<td class="comment-1" rowspan="1">Is ERIC on the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="77dd"></span>77DD</td>
<td class="instruction">JR Z,$77F0</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="77df"></span>77DF</td>
<td class="instruction">LD L,$A6</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="77A6.html">77A6</a> (skool region data table for the bottom floor)</td>
</tr>
<tr>
<td class="address-1"><span id="77e1"></span>77E1</td>
<td class="instruction">CP $A9</td>
<td class="comment-1" rowspan="1">Is ERIC on the bottom floor?</td>
</tr>
<tr>
<td class="address-1"><span id="77e3"></span>77E3</td>
<td class="instruction">JR Z,$77F0</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="77e5"></span>
<div class="comments">
<div class="paragraph">
ERIC is on a staircase. Is he sitting on the stairs?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="77e5"></span>77E5</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7FFB.html">7FFB</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="77e6"></span>77E6</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Reset the zero flag if ERIC is sitting</td>
</tr>
<tr>
<td class="address-1"><span id="77e8"></span>77E8</td>
<td class="instruction">LD A,$07</td>
<td class="comment-1" rowspan="1">This value is ignored</td>
</tr>
<tr>
<td class="address-1"><span id="77ea"></span>77EA</td>
<td class="instruction">JR Z,$77F8</td>
<td class="comment-1" rowspan="1">Jump unless ERIC is sitting on the stairs</td>
</tr>
<tr>
<td class="address-1"><span id="77ec"></span>77EC</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="DB80.html">0x00</a>: DON'T SIT ON THE STAIRS</td>
</tr>
<tr>
<td class="address-1"><span id="77ee"></span>77EE</td>
<td class="instruction">JR $7838</td>
<td class="comment-1" rowspan="1">Make any nearby teacher give lines</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="77f0"></span>
<div class="comments">
<div class="paragraph">
At this point, <span class="register">HL</span> holds the base address of a data table describing the regions in the skool (<a href="7790.html">7790</a> for the top floor, <a href="779C.html">779C</a> for the middle floor, or <a href="77A6.html">77A6</a> for the bottom floor).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="77f0"></span>77F0</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-2"><span id="77f1"></span>77F1</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the x-coordinate from the region table</td>
</tr>
<tr>
<td class="address-1"><span id="77f2"></span>77F2</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="77f3"></span>77F3</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="77f4"></span>77F4</td>
<td class="instruction">JR NC,$77F1</td>
<td class="comment-1" rowspan="1">Jump back until we've determined where ERIC is</td>
</tr>
<tr>
<td class="address-1"><span id="77f6"></span>77F6</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="2">Point <span class="register">DE</span> at the ID byte of the region table entry</td>
</tr>
<tr>
<td class="address-1"><span id="77f7"></span>77F7</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="77f8"></span>
<div class="comments">
<div class="paragraph">
<span id="regionID" /> The ID bytes in the region tables have the following meanings:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">Meaning</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="" colspan="1" rowspan="1">ERIC should never be here (head's study or staff room)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="" colspan="1" rowspan="1">Reading Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">Map Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">White Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Exam Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Revision Library</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">Dinner hall</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="" colspan="1" rowspan="1">None of the above</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="77f8"></span>77F8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ID of the region ERIC's in (7 if he's on a staircase)</td>
</tr>
<tr>
<td class="address-1"><span id="77f9"></span>77F9</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set the zero flag if ERIC's in a forbidden zone</td>
</tr>
<tr>
<td class="address-1"><span id="77fa"></span>77FA</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="DBA0.html">0x01</a>: THE ROOM IS PRIVATE</td>
</tr>
<tr>
<td class="address-1"><span id="77fc"></span>77FC</td>
<td class="instruction">JR Z,$7838</td>
<td class="comment-1" rowspan="1">Jump if ERIC's in the head's study or the staff room</td>
</tr>
<tr>
<td class="address-1"><span id="77fe"></span>77FE</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ID of the region ERIC's in</td>
</tr>
<tr>
<td class="address-1"><span id="77ff"></span>77FF</td>
<td class="instruction">LD L,$C8</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7FC8.html">7FC8</a> (lesson status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="7801"></span>7801</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="2">Jump if EINSTEIN has not had a chance to grass on ERIC for being absent yet, or dinner has not started yet, or this is PLAYTIME or REVISION LIBRARY</td>
</tr>
<tr>
<td class="address-1"><span id="7803"></span>7803</td>
<td class="instruction">JR Z,$782B</td>
</tr>
<tr>
<td class="address-2"><span id="7805"></span>7805</td>
<td class="instruction">LD A,($7FF4)</td>
<td class="comment-1" rowspan="1"><a href="7FF4.html">7FF4</a> holds the current lesson descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="7808"></span>7808</td>
<td class="instruction">AND $07</td>
<td class="comment-1" rowspan="1">Keep only the 'room' bits (0-2)</td>
</tr>
<tr>
<td class="address-1"><span id="780a"></span>780A</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="780b"></span>780B</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare this with ERIC's region ID</td>
</tr>
<tr>
<td class="address-1"><span id="780c"></span>780C</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="780d"></span>780D</td>
<td class="instruction">LD A,$02</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="DBC0.html">0x02</a>: GET TO WHERE YOU SHOULD BE</td>
</tr>
<tr>
<td class="address-1"><span id="780f"></span>780F</td>
<td class="instruction">JR NZ,$7838</td>
<td class="comment-1" rowspan="1">Jump if ERIC is not where he should be</td>
</tr>
<tr>
<td class="address-1"><span id="7811"></span>7811</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the lesson status flags from <a href="7FC8.html">7FC8</a></td>
</tr>
<tr>
<td class="address-1"><span id="7812"></span>7812</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="2">Set the carry flag if ERIC's lesson has started with ERIC present</td>
</tr>
<tr>
<td class="address-1"><span id="7813"></span>7813</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-2"><span id="7814"></span>7814</td>
<td class="instruction">LD A,($AC60)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="7817"></span>7817</td>
<td class="instruction">JR NC,$7822</td>
<td class="comment-1" rowspan="1">Jump if ERIC's lesson has not started</td>
</tr>
<tr>
<td class="address-1"><span id="7819"></span>7819</td>
<td class="instruction">AND $0F</td>
<td class="comment-1" rowspan="2">ERIC's lesson has started; is ERIC sitting in a chair?</td>
</tr>
<tr>
<td class="address-1"><span id="781b"></span>781B</td>
<td class="instruction">CP $05</td>
</tr>
<tr>
<td class="address-1"><span id="781d"></span>781D</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="781e"></span>781E</td>
<td class="instruction">LD A,$03</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="DBE0.html">0x03</a>: NOW FIND A SEAT</td>
</tr>
<tr>
<td class="address-1"><span id="7820"></span>7820</td>
<td class="instruction">JR $7838</td>
<td class="comment-1" rowspan="1">Make any nearby teacher give lines</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7822"></span>
<div class="comments">
<div class="paragraph">
ERIC's lesson has not started yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="7822"></span>7822</td>
<td class="instruction">AND $07</td>
<td class="comment-1" rowspan="2">Is ERIC standing, or midstride, or sitting on a chair?</td>
</tr>
<tr>
<td class="address-1"><span id="7824"></span>7824</td>
<td class="instruction">CP $06</td>
</tr>
<tr>
<td class="address-1"><span id="7826"></span>7826</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="7827"></span>7827</td>
<td class="instruction">LD A,$04</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="DC80.html">0x04</a>: GET OFF THE FLOOR</td>
</tr>
<tr>
<td class="address-1"><span id="7829"></span>7829</td>
<td class="instruction">JR $7838</td>
<td class="comment-1" rowspan="1">Make any nearby teacher give lines</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="782b"></span>
<div class="comments">
<div class="paragraph">
Bit 7 of <a href="7FC8.html">7FC8</a> is reset, which means EINSTEIN has not yet had a chance to grass on ERIC for being absent at the start of the lesson, or dinner has not started yet, or this is PLAYTIME or REVISION LIBRARY.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="782b"></span>782B</td>
<td class="instruction">CP $05</td>
<td class="comment-1" rowspan="1">Is ERIC in a room?</td>
</tr>
<tr>
<td class="address-1"><span id="782d"></span>782D</td>
<td class="instruction">JR NC,$7814</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="782f"></span>782F</td>
<td class="instruction">LD A,($7FF8)</td>
<td class="comment-1" rowspan="1">Pick up the MSB of the lesson clock in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="7832"></span>7832</td>
<td class="instruction">CP $13</td>
<td class="comment-1" rowspan="1">Should ERIC have left the room he was in last period?</td>
</tr>
<tr>
<td class="address-1"><span id="7834"></span>7834</td>
<td class="instruction">JR NC,$7814</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="7836"></span>7836</td>
<td class="instruction">JR $7805</td>
<td class="comment-1" rowspan="1">Otherwise check ERIC's location</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7838"></span>
<div class="comments">
<div class="paragraph">
ERIC is not where he should be, or is not sitting down when he should be, or is sitting on the floor or on the stairs. In short, he should be given lines by any adult witness. At this point <span class="register">A</span> holds one of the following values:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Meaning</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">0</td>
<td class="" colspan="1" rowspan="1">ERIC is sitting on the stairs</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">1</td>
<td class="" colspan="1" rowspan="1">ERIC is in the head's study or the staff room</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">ERIC is not in the room he should be in</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">ERIC is not sitting down when he should be</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">ERIC is sitting on the floor</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="7838"></span>7838</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=0, 1, 2, 3 or 4</td>
</tr>
<tr>
<td class="address-1"><span id="7839"></span>7839</td>
<td class="instruction">LD L,$F2</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="7FF2.html">7FF2</a>: lines-giving delay counter (0x00-0x49)</td>
</tr>
<tr>
<td class="address-1"><span id="783b"></span>783B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Is it too soon for the same teacher to give ERIC lines twice in a row?</td>
</tr>
<tr>
<td class="address-1"><span id="783c"></span>783C</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="783d"></span>783D</td>
<td class="instruction">JR Z,$7846</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="783f"></span>783F</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Otherwise, collect from <a href="7FF3.html">7FF3</a> into <span class="register">H</span> the character number of the teacher who last gave ERIC lines</td>
</tr>
<tr>
<td class="address-1"><span id="7840"></span>7840</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="7841"></span>7841</td>
<td class="instruction">LD L,$62</td>
<td class="comment-1" rowspan="3">Store this teacher's x-coordinate in <span class="register">E</span>, and set his x-coordinate to 255 temporarily, so he's out of range and will not be regarded as a lines-giving candidate</td>
</tr>
<tr>
<td class="address-1"><span id="7843"></span>7843</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="7844"></span>7844</td>
<td class="instruction">LD (HL),$FF</td>
</tr>
<tr>
<td class="address-2"><span id="7846"></span>7846</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7847"></span>7847</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7848"></span>7848</td>
<td class="instruction">LD D,C</td>
<td class="comment-1" rowspan="2"><span class="register">DE</span>=ERIC's coordinates</td>
</tr>
<tr>
<td class="address-1"><span id="7849"></span>7849</td>
<td class="instruction">LD E,B</td>
</tr>
<tr>
<td class="address-1"><span id="784a"></span>784A</td>
<td class="instruction">LD HL,$AC60</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at ERIC's character buffer</td>
</tr>
<tr>
<td class="address-1"><span id="784d"></span>784D</td>
<td class="instruction">CALL <a href="6E90.html#6e96">$6E96</a></td>
<td class="comment-1" rowspan="1">Get the floor closest to ERIC (0x9B, 0xA2 or 0xA9) in <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="7850"></span>7850</td>
<td class="instruction">CALL <a href="6E3C.html#6e3f">$6E3F</a></td>
<td class="comment-1" rowspan="1">Can ERIC be seen by a teacher?</td>
</tr>
<tr>
<td class="address-1"><span id="7853"></span>7853</td>
<td class="instruction">JR C,$7860</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="7855"></span>7855</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7856"></span>7856</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7857"></span>7857</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return unless we need to restore the x-coordinate of the last teacher who gave ERIC lines</td>
</tr>
<tr>
<td class="address-1"><span id="7858"></span>7858</td>
<td class="instruction">LD A,($7FF3)</td>
<td class="comment-1" rowspan="4">Restore the x-coordinate of the teacher who was temporarily placed out of lines-giving range</td>
</tr>
<tr>
<td class="address-1"><span id="785b"></span>785B</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="785c"></span>785C</td>
<td class="instruction">LD L,$62</td>
</tr>
<tr>
<td class="address-1"><span id="785e"></span>785E</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="785f"></span>785F</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7860"></span>
<div class="comments">
<div class="paragraph">
Time to dish out some lines to ERIC.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="7860"></span>7860</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7861"></span>7861</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="7862"></span>7862</td>
<td class="instruction">JR Z,$786B</td>
<td class="comment-1" rowspan="1">Jump unless we need to restore the x-coordinate of the last teacher who gave ERIC lines</td>
</tr>
<tr>
<td class="address-1"><span id="7864"></span>7864</td>
<td class="instruction">LD A,($7FF3)</td>
<td class="comment-1" rowspan="4">Restore the x-coordinate of the teacher who was temporarily placed out of lines-giving range</td>
</tr>
<tr>
<td class="address-1"><span id="7867"></span>7867</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="7868"></span>7868</td>
<td class="instruction">LD L,$62</td>
</tr>
<tr>
<td class="address-1"><span id="786a"></span>786A</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-2"><span id="786b"></span>786B</td>
<td class="instruction">LD B,D</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=0, 1, 2, 3 or 4 (lines reprimand ID)</td>
</tr>
<tr>
<td class="address-1"><span id="786c"></span>786C</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="4"><span class="register">H</span>=character number of the teacher who saw ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="786d"></span>786D</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address-1"><span id="786e"></span>786E</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address-1"><span id="786f"></span>786F</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address-1"><span id="7870"></span>7870</td>
<td class="instruction">LD L,$96</td>
<td class="comment-1" rowspan="2">Reset the lines-giving delay counter at <a href="7FF2.html">7FF2</a> to 0x96, and set <a href="7FF3.html">7FF3</a> to the character number of the teacher who saw ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="7872"></span>7872</td>
<td class="instruction">LD ($7FF2),HL</td>
</tr>
<tr>
<td class="address-1"><span id="7875"></span>7875</td>
<td class="instruction">LD L,$62</td>
<td class="comment-1" rowspan="4"><span class="register">DE</span>=coordinates of the teacher who saw ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="7877"></span>7877</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="7878"></span>7878</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="7879"></span>7879</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="787a"></span>787A</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=0, 1, 2, 3 or 4 (lines reprimand ID)</td>
</tr>
<tr>
<td class="address-1"><span id="787b"></span>787B</td>
<td class="instruction">CP $02</td>
<td class="comment-1" rowspan="1">Was ERIC spotted somewhere other than where he should be?</td>
</tr>
<tr>
<td class="address-1"><span id="787d"></span>787D</td>
<td class="instruction">JR NZ,$78A3</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="787f"></span>
<div class="comments">
<div class="paragraph">
ERIC was spotted somewhere other than where he should be. The appropriate lines reprimand depends on who saw him: his teacher for this period, or another teacher.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="787f"></span>787F</td>
<td class="instruction">LD A,($7FF4)</td>
<td class="comment-1" rowspan="1">Pick up the current lesson descriptor from <a href="7FF4.html">7FF4</a></td>
</tr>
<tr>
<td class="address-1"><span id="7882"></span>7882</td>
<td class="instruction">AND $F0</td>
<td class="comment-1" rowspan="1">Keep only the teacher bits (4-7)</td>
</tr>
<tr>
<td class="address-1"><span id="7884"></span>7884</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="5"><span class="register">A</span>=character number of ERIC's teacher for this period</td>
</tr>
<tr>
<td class="address-1"><span id="7885"></span>7885</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="7886"></span>7886</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="7887"></span>7887</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="7888"></span>7888</td>
<td class="instruction">ADD A,$A3</td>
</tr>
<tr>
<td class="address-1"><span id="788a"></span>788A</td>
<td class="instruction">CP H</td>
<td class="comment-1" rowspan="1">Was it ERIC's teacher who saw him?</td>
</tr>
<tr>
<td class="address-1"><span id="788b"></span>788B</td>
<td class="instruction">JR NZ,$78A3</td>
<td class="comment-1" rowspan="1">Jump if not (with <span class="register">B</span>=<a href="DBC0.html">0x02</a>: GET TO WHERE YOU SHOULD BE)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="788d"></span>
<div class="comments">
<div class="paragraph">
The truant ERIC has been spotted by his teacher for this period.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="788d"></span>788D</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="DCA0.html">0x05</a>: COME ALONG WITH ME BOY</td>
</tr>
<tr>
<td class="address-1"><span id="788f"></span>788F</td>
<td class="instruction">LD A,($7FC8)</td>
<td class="comment-1" rowspan="1">Bits 4 and 5 of <a href="7FC8.html">7FC8</a> hold the flags that determine ERIC's teacher's next lines reprimand</td>
</tr>
<tr>
<td class="address-1"><span id="7892"></span>7892</td>
<td class="instruction">BIT 5,A</td>
<td class="comment-1" rowspan="1">Set the zero flag if ERIC's teacher hasn't said 'COME ALONG WITH ME BOY' yet</td>
</tr>
<tr>
<td class="address-1"><span id="7894"></span>7894</td>
<td class="instruction">SET 5,A</td>
<td class="comment-1" rowspan="1">Indicate that he has said this now</td>
</tr>
<tr>
<td class="address-1"><span id="7896"></span>7896</td>
<td class="instruction">JR Z,$78A0</td>
<td class="comment-1" rowspan="1">Jump if ERIC's teacher has spotted him for the first time</td>
</tr>
<tr>
<td class="address-1"><span id="7898"></span>7898</td>
<td class="instruction">XOR $10</td>
<td class="comment-1" rowspan="1">Flip bit 4</td>
</tr>
<tr>
<td class="address-1"><span id="789a"></span>789A</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<a href="DCC0.html">0x06</a>: HURRY UP YOU HORROR</td>
</tr>
<tr>
<td class="address-1"><span id="789b"></span>789B</td>
<td class="instruction">BIT 4,A</td>
<td class="comment-1" rowspan="1">Should ERIC's teacher say this next?</td>
</tr>
<tr>
<td class="address-1"><span id="789d"></span>789D</td>
<td class="instruction">JR Z,$78A0</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="789f"></span>789F</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<a href="DCE0.html">0x07</a>: DON'T TRY MY PATIENCE BOY</td>
</tr>
<tr>
<td class="address-2"><span id="78a0"></span>78A0</td>
<td class="instruction">LD ($7FC8),A</td>
<td class="comment-1" rowspan="1">Update the truancy lines reprimand flags in <a href="7FC8.html">7FC8</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="78a3"></span>
<div class="comments">
<div class="paragraph">
Now <span class="register">B</span> holds the appropriate lines reprimand ID. Finally, give lines to ERIC.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="78a3"></span>78A3</td>
<td class="instruction">LD A,$AC</td>
<td class="comment-1" rowspan="1">0xAC=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="78a5"></span>78A5</td>
<td class="instruction">JP <a href="7700.html">$7700</a></td>
<td class="comment-1" rowspan="1">Give lines to ERIC</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="77A6.html">77A6</a>
</td>
<td class="up">Up: <a href="../maps/all.html#77ac">Map</a></td>
<td class="next">
Next: <a href="78A8.html">78A8</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20191114</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../dec/asm/30636.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>