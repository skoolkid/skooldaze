<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 7CF1</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="7CE0.html">7CE0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#7cf1">Map</a></td>
<td class="next">
Next: <a href="7CFC.html">7CFC</a>
</td>
</tr>
</table>
<div class="description">7CF1: Call an interruptible subcommand</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="7CFC.html">7CFC</a>, <a href="7D30.html">7D30</a>, <a href="7D9E.html">7D9E</a>, <a href="F300.html">F300</a> and <a href="F400.html">F400</a>. Drops the return address from the stack and copies its LSB into byte 0x63 of the character's buffer (where the LSB of the address of the primary command routine is held), copies the address of the interruptible subcommand routine from <span class="register">BC</span> into bytes 0x6A and 0x6B of the character's buffer, and then jumps to that routine.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">BC</td>
<td class="register-desc">Interruptible subcommand routine address</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0x98-0xA9)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="7cf1"></span>7CF1</td>
<td class="instruction">LD L,$6A</td>
<td class="comment-1" rowspan="4">Copy the routine address from <span class="register">BC</span> into bytes 0x69 and 0x6A of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="7cf3"></span>7CF3</td>
<td class="instruction">LD (HL),B</td>
</tr>
<tr>
<td class="address-1"><span id="7cf4"></span>7CF4</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="7cf5"></span>7CF5</td>
<td class="instruction">LD (HL),C</td>
</tr>
<tr>
<td class="address-1"><span id="7cf6"></span>7CF6</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="3">Drop the return address off the stack and place its LSB into byte 0x63 of the character's buffer; this ensures that when the interruptible subcommand has finished, control resumes in the caller of this routine</td>
</tr>
<tr>
<td class="address-1"><span id="7cf7"></span>7CF7</td>
<td class="instruction">LD L,$63</td>
</tr>
<tr>
<td class="address-1"><span id="7cf9"></span>7CF9</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="7cfa"></span>7CFA</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Make an indirect jump to the routine address in <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="7cfb"></span>7CFB</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="7CE0.html">7CE0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#7cf1">Map</a></td>
<td class="next">
Next: <a href="7CFC.html">7CFC</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20200809</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/31985.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>