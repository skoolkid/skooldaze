<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at F533</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F51E.html">F51E</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f533">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F5B6.html">F5B6</a></span></td>
</tr>
</table>
<div class="description">F533: Deal with ERIC when he's jumping</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="6AD9.html">6AD9</a> when bit 2 of ERIC's status flags at <a href="7FFB.html">7FFB</a> is set (by the routine at <a href="F46E.html">F46E</a>, via <a href="F499.html">F499</a>).
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f533"></span>F533</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,$7FF6</td>
<td class="comment-11" rowspan="1">Decrement the jumping action timer at <a href="7FF6.html">7FF6</a> (which starts at 0x10)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f536"></span>F536</td>
<td class="bytes-0"></td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Has ERIC completed the jump?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f537"></span>F537</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="F41F.html#f425">$F425</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f53a"></span>F53A</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the current value of the action timer in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f53b"></span>F53B</td>
<td class="bytes-0"></td>
<td class="instruction">CP $0C</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f53d"></span>F53D</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,$0F</td>
<td class="comment-11" rowspan="1">Lines reprimand <a href="DEE0.html">0x0F</a>: YOU ARE NOT A KANGAROO</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f53f"></span>F53F</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="F41F.html#f456">$F456</a></td>
<td class="comment-11" rowspan="1">Jump if it's time to check whether any teachers can see ERIC jumping</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f542"></span>F542</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,$AC</td>
<td class="comment-11" rowspan="1">0xAC=ERIC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f544"></span>F544</td>
<td class="bytes-0"></td>
<td class="instruction">CP $0D</td>
<td class="comment-11" rowspan="1">Is it time to check whether ERIC has touched a shield or opened the safe?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f546"></span>F546</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="F51E.html">$F51E</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f549"></span>F549</td>
<td class="bytes-0"></td>
<td class="instruction">CP $0E</td>
<td class="comment-11" rowspan="1">Is it time to make the jumping sound effect?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f54b"></span>F54B</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="EAEB.html">$EAEB</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f54e"></span>F54E</td>
<td class="bytes-0"></td>
<td class="instruction">CP $09</td>
<td class="comment-11" rowspan="1">Is it time to move ERIC's arm back?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f550"></span>F550</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="7067.html#706b">$706B</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f553"></span>F553</td>
<td class="bytes-0"></td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">Is it time to bring ERIC back down to the floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f555"></span>F555</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,$F55E</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f557"></span>F557</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6214.html">$6214</a></td>
<td class="comment-11" rowspan="1">Update the SRB for ERIC's current location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f55a"></span>F55A</td>
<td class="bytes-0"></td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Move ERIC downwards</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f55b"></span>F55B</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="61B0.html">$61B0</a></td>
<td class="comment-11" rowspan="1">Update ERIC's location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f55e"></span>F55E</td>
<td class="bytes-0"></td>
<td class="instruction">CP $06</td>
<td class="comment-11" rowspan="2">Return if <span class="register">A</span> &lt; 0x06 (nothing to check or do)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f560"></span>F560</td>
<td class="bytes-0"></td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f561"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">A</span>=0x06 (which means it's time to check whether ERIC has jumped onto a boy, or ERIC is already standing on a boy), or <span class="register">A</span> is one of {0x07, 0x08, 0x0A, 0x0B, 0x0F}, or <span class="register">A</span>&gt;0x80 (which means ERIC has jumped while standing on a boy).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f561"></span>F561</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,$F5AB</td>
<td class="comment-11" rowspan="1">Jump unless (a) it's time to check whether ERIC has jumped on a boy, or (b) ERIC is already standing on a boy</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f563"></span>
<div class="comments">
<div class="paragraph">
This entry point is erroneously used by the routine at <a href="EAEB.html">EAEB</a> with <span class="register">H</span>=0x03 (which means (<span class="register">D</span>,<span class="register">E</span>) is set to (198,32) by the code that follows, and the routine exits at <a href="F533.html#f579">F579</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f563"></span>F563</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$61</td>
<td class="comment-11" rowspan="1">Byte 0x61 of ERIC's buffer holds his y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f565"></span>F565</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f566"></span>F566</td>
<td class="bytes-0"></td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Down a level (where the boy that ERIC is standing on would be, if any)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f567"></span>F567</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Byte 0x62 holds ERIC's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f568"></span>F568</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f569"></span>F569</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,$0B</td>
<td class="comment-11" rowspan="1">There are 11 little boys</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f56b"></span>F56B</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,$98</td>
<td class="comment-11" rowspan="1">0x98=little boy no. 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f56d"></span>F56D</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="F5B9.html">$F5B9</a></td>
<td class="comment-11" rowspan="1">Is ERIC standing on a little boy?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f570"></span>F570</td>
<td class="bytes-0"></td>
<td class="instruction">JR C,$F57A</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f572"></span>F572</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,$A7</td>
<td class="comment-11" rowspan="1">0xA7=BOY WANDER</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f574"></span>F574</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,$03</td>
<td class="comment-11" rowspan="1">There are three main kids besides ERIC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f576"></span>F576</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="F5B9.html#f5bf">$F5BF</a></td>
<td class="comment-11" rowspan="1">Is ERIC standing on one of the three main kids?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f579"></span>F579</td>
<td class="bytes-0"></td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f57a"></span>
<div class="comments">
<div class="paragraph">
ERIC is standing on a kid who's been knocked out.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f57a"></span>F57A</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="673A.html">$673A</a></td>
<td class="comment-11" rowspan="1">Check for keypresses</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f57d"></span>F57D</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,$7FF6</td>
<td class="comment-11" rowspan="2">Set the jumping action timer at <a href="7FF6.html">7FF6</a> to 0x07, so that we keep returning to this section of code while ERIC is standing on a boy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f580"></span>F580</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),$07</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f582"></span>F582</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if no key of interest was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f583"></span>F583</td>
<td class="bytes-0"></td>
<td class="instruction">SET 5,A</td>
<td class="comment-11" rowspan="1">Convert the ASCII code of the keypress in <span class="register">A</span> to lower case</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f585"></span>F585</td>
<td class="bytes-0"></td>
<td class="instruction">CP $6A</td>
<td class="comment-11" rowspan="1">Was 'j' (jump) pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f587"></span>F587</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,$F58C</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f589"></span>F589</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),$90</td>
<td class="comment-11" rowspan="1">Set the jumping action timer at <a href="7FF6.html">7FF6</a> to 0x90 to indicate that ERIC has jumped while standing on a boy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f58b"></span>F58B</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return to the main loop with the carry flag reset</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f58c"></span>
<div class="comments">
<div class="paragraph">
A key other than 'j' was pressed while ERIC was standing on a boy.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f58c"></span>F58C</td>
<td class="bytes-0"></td>
<td class="instruction">CP $6F</td>
<td class="comment-11" rowspan="1">0x6F='o'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f58e"></span>F58E</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,$00</td>
<td class="comment-11" rowspan="1">Set <span class="register">B</span>=<a href="../graphics/as.html#0">0x00</a> (ERIC facing left) for later comparison</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f590"></span>F590</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,$F597</td>
<td class="comment-11" rowspan="1">Jump if 'o' (left) was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f592"></span>F592</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,$80</td>
<td class="comment-11" rowspan="1">Set <span class="register">B</span>=<a href="../graphics/as.html#128">0x80</a> (ERIC facing right) for later comparison</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f594"></span>F594</td>
<td class="bytes-0"></td>
<td class="instruction">CP $70</td>
<td class="comment-11" rowspan="1">Was 'p' (right) pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f596"></span>F596</td>
<td class="bytes-0"></td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f597"></span>F597</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,$AC66</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=animatory state of ERIC before he jumped (stored in byte 0x66 of his buffer)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f59a"></span>F59A</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f59b"></span>F59B</td>
<td class="bytes-0"></td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">Keep only the 'direction' bit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f59d"></span>F59D</td>
<td class="bytes-0"></td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Should ERIC turn round?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f59e"></span>F59E</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f59f"></span>F59F</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">Adjust ERIC's pre-jump animatory state to reflect his turning round while standing on a boy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5a0"></span>F5A0</td>
<td class="bytes-0"></td>
<td class="instruction">XOR $80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5a2"></span>F5A2</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5a3"></span>F5A3</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6214.html">$6214</a></td>
<td class="comment-11" rowspan="1">Update the SRB for ERIC's current animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5a6"></span>F5A6</td>
<td class="bytes-0"></td>
<td class="instruction">XOR $80</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of ERIC facing the other way</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5a8"></span>F5A8</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="61B0.html">$61B0</a></td>
<td class="comment-11" rowspan="1">Update ERIC's animatory state and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f5ab"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">A</span> is one of {0x07, 0x08, 0x0A, 0x0B, 0x0F} (which means there is nothing to do), or <span class="register">A</span>=0x80-0x8F (which means ERIC has jumped while standing on a boy).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f5ab"></span>F5AB</td>
<td class="bytes-0"></td>
<td class="instruction">CP $86</td>
<td class="comment-11" rowspan="2">Return now if the SUB $80 instruction below would make <span class="register">A</span>=0x06</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5ad"></span>F5AD</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5ae"></span>F5AE</td>
<td class="bytes-0"></td>
<td class="instruction">SUB $80</td>
<td class="comment-11" rowspan="2">Return unless ERIC jumped while standing on a boy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5b0"></span>F5B0</td>
<td class="bytes-0"></td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f5b1"></span>
<div class="comments">
<div class="paragraph">
So ERIC has jumped while standing on a boy. Now either <span class="register">A</span>=0x00, meaning it's time to set the jumping action timer at <a href="7FF6.html">7FF6</a> back to 7, so we can deal with ERIC while he's standing on a boy; or <span class="register">A</span>=0x01-0x0F (but not 0x06, because that would lead us into the code at <a href="F533.html#f563">F563</a> to perform a redundant check on whether ERIC is standing on a boy), meaning we need to run the usual checks while ERIC is in mid-air.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5b1"></span>F5B1</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,$F53B</td>
<td class="comment-11" rowspan="1">Run the usual checks while ERIC is in mid-air above a supine boy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f5b4"></span>F5B4</td>
<td class="bytes-0"></td>
<td class="instruction">JR $F57C</td>
<td class="comment-11" rowspan="1">This should be JR <a href="F533.html#f57d">F57D</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F51E.html">F51E</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f533">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F5B6.html">F5B6</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20190614</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../dec/asm/62771.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>