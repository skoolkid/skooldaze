<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 27126</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27125.html">27125</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27126">Map</a></td>
<td class="next">
Next: <a href="27191.html">27191</a>
</td>
</tr>
</table>
<div class="description">27126: Make a little boy trip people up</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this continual subcommand routine is placed into bytes 124 and 125 of little boy no. 1's character buffer by the routine at <a href="27246.html">27246</a>, and into bytes 124 and 125 of the character buffers of little boys 2-11 by the routine at <a href="27266.html">27266</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Little boy's character number (152-162)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="27126"></span>27126</td>
<td class="instruction">LD L,97</td>
<td class="comment-1" rowspan="2">Pick up the little boy's y-coordinate in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="27128"></span>27128</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="27129"></span>27129</td>
<td class="instruction">CALL <a href="26184.html#26185">26185</a></td>
<td class="comment-1" rowspan="1">Is the boy on a staircase?</td>
</tr>
<tr>
<td class="address-1"><span id="27132"></span>27132</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="27133"></span>27133</td>
<td class="instruction">LD B,10</td>
<td class="comment-1" rowspan="1">We will check characters 163-172 (teachers and main kids)</td>
</tr>
<tr>
<td class="address-1"><span id="27135"></span>27135</td>
<td class="instruction">LD DE,41826</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=163 (MR WACKER), <span class="register">E</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="27138"></span>27138</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="27139"></span>27139</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="27140"></span>27140</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=little boy's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="27141"></span>27141</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Does this teacher's or main kid's x-coordinate match?</td>
</tr>
<tr>
<td class="address-1"><span id="27142"></span>27142</td>
<td class="instruction">JR Z,27149</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-2"><span id="27144"></span>27144</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Next teacher or main kid</td>
</tr>
<tr>
<td class="address-1"><span id="27145"></span>27145</td>
<td class="instruction">DJNZ 27140</td>
<td class="comment-1" rowspan="1">Jump back until all teachers and main kids have been checked</td>
</tr>
<tr>
<td class="address-1"><span id="27147"></span>27147</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27148"></span>27148</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27149"></span>
<div class="comments">
<div class="paragraph">
A teacher or main kid is at the same x-coordinate as the little boy. Now check the y-coordinates.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27149"></span>27149</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="2"><span class="register">E</span>=<span class="register">L</span>=97</td>
</tr>
<tr>
<td class="address-1"><span id="27150"></span>27150</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="27151"></span>27151</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=little boy's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="27152"></span>27152</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="27153"></span>27153</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Does this teacher's or main kid's y-coordinate match?</td>
</tr>
<tr>
<td class="address-1"><span id="27154"></span>27154</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="27155"></span>27155</td>
<td class="instruction">JR NZ,27144</td>
<td class="comment-1" rowspan="1">Consider the next teacher or main kid if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27157"></span>
<div class="comments">
<div class="paragraph">
A teacher or main kid is at the same location as the little boy.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="27157"></span>27157</td>
<td class="instruction">LD L,112</td>
<td class="comment-1" rowspan="2">Bytes 111 and 112 of the character's buffer may hold a routine address; pick up the MSB in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="27159"></span>27159</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="27160"></span>27160</td>
<td class="instruction">LD L,98</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27162"></span>27162</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is there an uninterruptible subcommand routine address in bytes 111 and 112?</td>
</tr>
<tr>
<td class="address-1"><span id="27163"></span>27163</td>
<td class="instruction">JR NZ,27144</td>
<td class="comment-1" rowspan="1">Consider the next teacher or main kid if so</td>
</tr>
<tr>
<td class="address-1"><span id="27165"></span>27165</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=number of the character in the same location as the little boy</td>
</tr>
<tr>
<td class="address-1"><span id="27166"></span>27166</td>
<td class="instruction">CP 172</td>
<td class="comment-1" rowspan="1">Is it ERIC?</td>
</tr>
<tr>
<td class="address-1"><span id="27168"></span>27168</td>
<td class="instruction">JR Z,27184</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="27170"></span>27170</td>
<td class="instruction">LD L,111</td>
<td class="comment-1" rowspan="4">Place the address of the uninterruptible subcommand routine at <a href="27206.html">27206</a> into bytes 111 and 112 of the teacher's or main kid's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="27172"></span>27172</td>
<td class="instruction">LD (HL),70</td>
</tr>
<tr>
<td class="address-1"><span id="27174"></span>27174</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="27175"></span>27175</td>
<td class="instruction">LD (HL),106</td>
</tr>
<tr>
<td class="address-1"><span id="27177"></span>27177</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Initialise the timing parameter in byte 113 of the character's buffer (which determines how long the character will stay down)</td>
</tr>
<tr>
<td class="address-1"><span id="27178"></span>27178</td>
<td class="instruction">LD (HL),20</td>
</tr>
<tr>
<td class="address-1"><span id="27180"></span>27180</td>
<td class="instruction">LD L,98</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27182"></span>27182</td>
<td class="instruction">JR 27144</td>
<td class="comment-1" rowspan="1">Consider the next teacher or main kid</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27184"></span>
<div class="comments">
<div class="paragraph">
ERIC is in the same location as the little boy. Knock ERIC out.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27184"></span>27184</td>
<td class="instruction">LD HL,32763</td>
<td class="comment-1" rowspan="1"><a href="32763.html">32763</a> holds ERIC's status flags</td>
</tr>
<tr>
<td class="address-1"><span id="27187"></span>27187</td>
<td class="instruction">SET 4,(HL)</td>
<td class="comment-1" rowspan="1">Signal: ERIC has been knocked out</td>
</tr>
<tr>
<td class="address-1"><span id="27189"></span>27189</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27190"></span>27190</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27125.html">27125</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27126">Map</a></td>
<td class="next">
Next: <a href="27191.html">27191</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20221122</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/69F6.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>