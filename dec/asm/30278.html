<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 30278</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="30276.html">30276</a>
</td>
<td class="up">Up: <a href="../maps/all.html#30278">Map</a></td>
<td class="next">
Next: <a href="30406.html">30406</a>
</td>
</tr>
</table>
<div class="description">30278: Generate graphic data for a number</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="30408.html">30408</a> and <a href="30432.html">30432</a>. Generates a 7x24-bit graphic for the digits of the number in <span class="register">DE</span>, and stores it in the buffer at <a href="55552.html#55563">55563</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Number</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="30278"></span>30278</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30279"></span>30279</td>
<td class="instruction">LD HL,55583</td>
<td class="comment-1" rowspan="6">Blank out the 32-byte buffer at <a href="55552.html">55552</a></td>
</tr>
<tr>
<td class="address-1"><span id="30282"></span>30282</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address-1"><span id="30283"></span>30283</td>
<td class="instruction">LD B,31</td>
</tr>
<tr>
<td class="address-2"><span id="30285"></span>30285</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="30286"></span>30286</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="30287"></span>30287</td>
<td class="instruction">DJNZ 30285</td>
</tr>
<tr>
<td class="address-1"><span id="30289"></span>30289</td>
<td class="instruction">LD A,48</td>
<td class="comment-1" rowspan="1">48 is the ASCII code for '0' (zero)</td>
</tr>
<tr>
<td class="address-1"><span id="30291"></span>30291</td>
<td class="instruction">LD BC,55536</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-10000</td>
</tr>
<tr>
<td class="address-1"><span id="30294"></span>30294</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=the number, <span class="register">DE</span>=<a href="55552.html">55552</a></td>
</tr>
<tr>
<td class="address-1"><span id="30295"></span>30295</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 10000</td>
</tr>
<tr>
<td class="address-1"><span id="30296"></span>30296</td>
<td class="instruction">JR C,30325</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 10000</td>
</tr>
<tr>
<td class="address-1"><span id="30298"></span>30298</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 10000 back on</td>
</tr>
<tr>
<td class="address-1"><span id="30300"></span>30300</td>
<td class="instruction">LD BC,64536</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-1000</td>
</tr>
<tr>
<td class="address-1"><span id="30303"></span>30303</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 1000</td>
</tr>
<tr>
<td class="address-1"><span id="30304"></span>30304</td>
<td class="instruction">JR C,30338</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 1000</td>
</tr>
<tr>
<td class="address-1"><span id="30306"></span>30306</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 1000 back on</td>
</tr>
<tr>
<td class="address-1"><span id="30308"></span>30308</td>
<td class="instruction">LD BC,65436</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-100</td>
</tr>
<tr>
<td class="address-1"><span id="30311"></span>30311</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 100</td>
</tr>
<tr>
<td class="address-1"><span id="30312"></span>30312</td>
<td class="instruction">JR C,30351</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 100</td>
</tr>
<tr>
<td class="address-1"><span id="30314"></span>30314</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 100 back on</td>
</tr>
<tr>
<td class="address-1"><span id="30316"></span>30316</td>
<td class="instruction">LD C,246</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-10</td>
</tr>
<tr>
<td class="address-1"><span id="30318"></span>30318</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Subtract 10</td>
</tr>
<tr>
<td class="address-1"><span id="30319"></span>30319</td>
<td class="instruction">JR C,30363</td>
<td class="comment-1" rowspan="1">Jump if the number is &gt; 10</td>
</tr>
<tr>
<td class="address-1"><span id="30321"></span>30321</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Add the 10 back on</td>
</tr>
<tr>
<td class="address-1"><span id="30323"></span>30323</td>
<td class="instruction">JR 30371</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30325"></span>
<div class="comments">
<div class="paragraph">
We get here if the number is &gt;= 10000.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="30325"></span>30325</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 10000 and get the ASCII code for the 10000s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="30326"></span>30326</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="30327"></span>30327</td>
<td class="instruction">JR C,30325</td>
</tr>
<tr>
<td class="address-1"><span id="30329"></span>30329</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="30331"></span>30331</td>
<td class="instruction">LD BC,64536</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-1000</td>
</tr>
<tr>
<td class="address-1"><span id="30334"></span>30334</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 10000s digit</td>
</tr>
<tr>
<td class="address-1"><span id="30335"></span>30335</td>
<td class="instruction">LD A,47</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30337"></span>30337</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-2"><span id="30338"></span>30338</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 1000 and get the ASCII code for the 1000s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="30339"></span>30339</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="30340"></span>30340</td>
<td class="instruction">JR C,30338</td>
</tr>
<tr>
<td class="address-1"><span id="30342"></span>30342</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="30344"></span>30344</td>
<td class="instruction">LD BC,65436</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-100</td>
</tr>
<tr>
<td class="address-1"><span id="30347"></span>30347</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 1000s digit</td>
</tr>
<tr>
<td class="address-1"><span id="30348"></span>30348</td>
<td class="instruction">LD A,47</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30350"></span>30350</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-2"><span id="30351"></span>30351</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 100 and get the ASCII code for the 100s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="30352"></span>30352</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="30353"></span>30353</td>
<td class="instruction">JR C,30351</td>
</tr>
<tr>
<td class="address-1"><span id="30355"></span>30355</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="30357"></span>30357</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 100s digit</td>
</tr>
<tr>
<td class="address-1"><span id="30358"></span>30358</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="30359"></span>30359</td>
<td class="instruction">LD C,246</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=-10</td>
</tr>
<tr>
<td class="address-1"><span id="30361"></span>30361</td>
<td class="instruction">LD A,47</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="30363"></span>30363</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Perform trial subtractions of 10 and get the ASCII code for the 10s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="30364"></span>30364</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="30365"></span>30365</td>
<td class="instruction">JR C,30363</td>
</tr>
<tr>
<td class="address-1"><span id="30367"></span>30367</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="address-1"><span id="30369"></span>30369</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the 10s digit</td>
</tr>
<tr>
<td class="address-1"><span id="30370"></span>30370</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-2"><span id="30371"></span>30371</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="2">Get the ASCII code for the units digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="30372"></span>30372</td>
<td class="instruction">ADD A,48</td>
</tr>
<tr>
<td class="address-1"><span id="30374"></span>30374</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code for the units digit</td>
</tr>
<tr>
<td class="address-1"><span id="30375"></span>30375</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30376"></span>30376</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="30377"></span>30377</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Mark the end of the number string with a 0 byte</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30378"></span>
<div class="comments">
<div class="paragraph">
Now that the ASCII codes for the digits of the number have been calculated and stored at <a href="55552.html">55552</a>, generate the corresponding graphic data.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="30378"></span>30378</td>
<td class="instruction">LD E,0</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="55552.html">55552</a> (first character in the number string)</td>
</tr>
<tr>
<td class="address-2"><span id="30380"></span>30380</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a character from the number string</td>
</tr>
<tr>
<td class="address-1"><span id="30381"></span>30381</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Have we reached the end of the string?</td>
</tr>
<tr>
<td class="address-1"><span id="30382"></span>30382</td>
<td class="instruction">JR NZ,30386</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="30384"></span>30384</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30385"></span>30385</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="30386"></span>30386</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move to the next character in the number string</td>
</tr>
<tr>
<td class="address-1"><span id="30387"></span>30387</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30388"></span>30388</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L'</span>=ASCII code for a digit of the number (48-57)</td>
</tr>
<tr>
<td class="address-1"><span id="30389"></span>30389</td>
<td class="instruction">LD H,217</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at the start of the font data for this digit</td>
</tr>
<tr>
<td class="address-1"><span id="30391"></span>30391</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the pixel width in <span class="register">B'</span></td>
</tr>
<tr>
<td class="address-1"><span id="30392"></span>30392</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Add 1 for left padding</td>
</tr>
<tr>
<td class="address-1"><span id="30393"></span>30393</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">An empty byte for left padding</td>
</tr>
<tr>
<td class="address-2"><span id="30394"></span>30394</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at the next bitmap byte</td>
</tr>
<tr>
<td class="address-1"><span id="30395"></span>30395</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30396"></span>30396</td>
<td class="instruction">CALL <a href="30258.html">30258</a></td>
<td class="comment-1" rowspan="1">Slide the bitmap byte into the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="30399"></span>30399</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30400"></span>30400</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the next bitmap byte</td>
</tr>
<tr>
<td class="address-1"><span id="30401"></span>30401</td>
<td class="instruction">DJNZ 30394</td>
<td class="comment-1" rowspan="1">Jump back until all bitmap bytes are done</td>
</tr>
<tr>
<td class="address-1"><span id="30403"></span>30403</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30404"></span>30404</td>
<td class="instruction">JR 30380</td>
<td class="comment-1" rowspan="1">Jump back to collect the next digit</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="30276.html">30276</a>
</td>
<td class="up">Up: <a href="../maps/all.html#30278">Map</a></td>
<td class="next">
Next: <a href="30406.html">30406</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/7646.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>