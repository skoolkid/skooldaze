<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 29442</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="29441.html">29441</a></span></td>
<td class="up">Up: <a href="../maps/all.html#29442">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="29513.html">29513</a></span></td>
</tr>
</table>
<div class="description">29442: Slide a message character into the speech bubble text window (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from the routine at <a href="29706.html">29706</a>. Returns with the carry flag set if the speech bubble is off-screen.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">ASCII code of the character</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="29442"></span>29442</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=ASCII code of the character from the message being spoken</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29443"></span>29443</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32612)</td>
<td class="comment-11" rowspan="1">Copy the speech bubble lip x-coordinate from <a href="32612.html">32612</a> to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29446"></span>29446</td>
<td class="bytes-0"></td>
<td class="instruction">AND 120</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=x-coordinate of the right edge of the text window within the speech bubble</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29448"></span>29448</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29450"></span>29450</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32512</td>
<td class="comment-11" rowspan="1"><a href="32512.html">32512</a> holds the leftmost column of the skool on screen (0-64)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29453"></span>29453</td>
<td class="bytes-0"></td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="2">Return with the carry flag set if the speech bubble is off-screen to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29454"></span>29454</td>
<td class="bytes-0"></td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29455"></span>29455</td>
<td class="bytes-0"></td>
<td class="instruction">CP 32</td>
<td class="comment-11" rowspan="3">Return with the carry flag set if the speech bubble is off-screen to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29457"></span>29457</td>
<td class="bytes-0"></td>
<td class="instruction">CCF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29458"></span>29458</td>
<td class="bytes-0"></td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29459"></span>
<div class="comments">
<div class="paragraph">
The speech bubble is on screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29459"></span>29459</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=screen x-coordinate of the right edge of the text window within the speech bubble (6, 14, 22 or 30)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29460"></span>29460</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32613)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=y-coordinate of the speech bubble lip</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29463"></span>29463</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 154</td>
<td class="comment-11" rowspan="2"><span class="register">D</span>=screen y-coordinate of the top row of the speech bubble (0-17)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29465"></span>29465</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29466"></span>29466</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="10">Set <span class="register">HL</span> to the display file address corresponding to the top right edge of the text window within the speech bubble</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29467"></span>29467</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29468"></span>29468</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29469"></span>29469</td>
<td class="bytes-0"></td>
<td class="instruction">AND 224</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29471"></span>29471</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29472"></span>29472</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29473"></span>29473</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29474"></span>29474</td>
<td class="bytes-0"></td>
<td class="instruction">AND 24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29476"></span>29476</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,68</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29478"></span>29478</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29479"></span>29479</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,217</td>
<td class="comment-11" rowspan="3"><span class="register">C</span>=width (in pixels) of the message character bitmap</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29481"></span>29481</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29482"></span>29482</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29483"></span>
<div class="comments">
<div class="paragraph">
Now we enter a loop to slide the pixel columns of the message character bitmap into the text window of the speech bubble.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="29483"></span>29483</td>
<td class="bytes-0"></td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=next pixel column of the message character bitmap</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29484"></span>29484</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29485"></span>29485</td>
<td class="bytes-0"></td>
<td class="instruction">CALL 29491</td>
<td class="comment-11" rowspan="1">Slide this into the speech bubble text window</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29488"></span>29488</td>
<td class="bytes-0"></td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Next pixel column</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29489"></span>29489</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,29483</td>
<td class="comment-11" rowspan="1">Jump back until all pixel columns are done</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="29491"></span>29491</td>
<td class="bytes-0"></td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Store the display file address temporarily</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29492"></span>29492</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="32216.html">32216</a></td>
<td class="comment-11" rowspan="1">Slide the top four pixel rows of the text window one pixel to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29495"></span>29495</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Store the message character pixel column in <span class="register">B</span> temporarily</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29496"></span>29496</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="7">Set <span class="register">HL</span> to the display file address corresponding to the fifth pixel row down from the top right edge of the text window within the speech bubble</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29497"></span>29497</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29499"></span>29499</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29500"></span>29500</td>
<td class="bytes-0"></td>
<td class="instruction">JR C,29506</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29502"></span>29502</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29503"></span>29503</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29505"></span>29505</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="29506"></span>29506</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Restore the message character pixel column to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29507"></span>29507</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="32216.html">32216</a></td>
<td class="comment-11" rowspan="1">Slide the bottom four pixel rows of the text window one pixel to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29510"></span>29510</td>
<td class="bytes-0"></td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the display file address to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29511"></span>29511</td>
<td class="bytes-0"></td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Reset the carry flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="29512"></span>29512</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="29441.html">29441</a></span></td>
<td class="up">Up: <a href="../maps/all.html#29442">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="29513.html">29513</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20190614</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/7302.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>