<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 29394</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29385.html">29385</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29394">Map</a></td>
<td class="next">
Next: <a href="29441.html">29441</a>
</td>
</tr>
</table>
<div class="description">29394: Update the SRB for the middle six columns of the speech bubble</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="29746.html">29746</a> and <a href="62714.html">62714</a>. Returns with the carry flag set if the speech bubble is off-screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29394"></span>29394</td>
<td class="instruction">LD DE,(32612)</td>
<td class="comment-1" rowspan="1">Copy the speech bubble lip coordinates from <a href="32612.html">32612</a> to <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="29398"></span>29398</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Now <span class="register">E</span> holds the x-coordinate of the left edge of the speech bubble</td>
</tr>
<tr>
<td class="address-1"><span id="29399"></span>29399</td>
<td class="instruction">AND 248</td>
</tr>
<tr>
<td class="address-1"><span id="29401"></span>29401</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="29402"></span>29402</td>
<td class="instruction">LD A,(32512)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=leftmost column of the skool on screen (0-64)</td>
</tr>
<tr>
<td class="address-1"><span id="29405"></span>29405</td>
<td class="instruction">SUB E</td>
<td class="comment-1" rowspan="1">Is the speech bubble at the far left of the screen?</td>
</tr>
<tr>
<td class="address-1"><span id="29406"></span>29406</td>
<td class="instruction">JR Z,29418</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="29408"></span>29408</td>
<td class="instruction">CCF</td>
<td class="comment-1" rowspan="2">Return with the carry flag set if the speech bubble is off-screen to the left</td>
</tr>
<tr>
<td class="address-1"><span id="29409"></span>29409</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="address-1"><span id="29410"></span>29410</td>
<td class="instruction">CP 225</td>
<td class="comment-1" rowspan="2">Return with the carry flag set if the speech bubble is off-screen to the right</td>
</tr>
<tr>
<td class="address-1"><span id="29412"></span>29412</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="address-1"><span id="29413"></span>29413</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="4"><span class="register">A</span>=1, 2 or 3 (corresponding to the quadrant of the screen containing the speech bubble)</td>
</tr>
<tr>
<td class="address-1"><span id="29415"></span>29415</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="29416"></span>29416</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="29417"></span>29417</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-2"><span id="29418"></span>29418</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=0-3 (quadrant of the screen containing the speech bubble)</td>
</tr>
<tr>
<td class="address-1"><span id="29419"></span>29419</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="7">Point <span class="register">DE</span> at the byte of the screen refresh buffer corresponding to the top row of the speech bubble</td>
</tr>
<tr>
<td class="address-1"><span id="29420"></span>29420</td>
<td class="instruction">SUB 151</td>
</tr>
<tr>
<td class="address-1"><span id="29422"></span>29422</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29423"></span>29423</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29424"></span>29424</td>
<td class="instruction">ADD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="29425"></span>29425</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="29426"></span>29426</td>
<td class="instruction">LD D,127</td>
</tr>
<tr>
<td class="address-1"><span id="29428"></span>29428</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="3">Set bits 1-6 of this screen refresh buffer byte (so that the part of the screen hidden by the middle 6 UDGs of the top row of the speech bubble will be refreshed)</td>
</tr>
<tr>
<td class="address-1"><span id="29429"></span>29429</td>
<td class="instruction">OR 126</td>
</tr>
<tr>
<td class="address-1"><span id="29431"></span>29431</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="29432"></span>29432</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Point <span class="register">DE</span> at the byte of the screen refresh buffer corresponding to the bottom row of the speech bubble</td>
</tr>
<tr>
<td class="address-1"><span id="29433"></span>29433</td>
<td class="instruction">ADD A,4</td>
</tr>
<tr>
<td class="address-1"><span id="29435"></span>29435</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="29436"></span>29436</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="3">Set bits 1-6 of this screen refresh buffer byte (so that the part of the screen hidden by the middle 6 UDGS of the bottom row of the speech bubble will be refreshed)</td>
</tr>
<tr>
<td class="address-1"><span id="29437"></span>29437</td>
<td class="instruction">OR 126</td>
</tr>
<tr>
<td class="address-1"><span id="29439"></span>29439</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="29440"></span>29440</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return with the carry flag reset</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29385.html">29385</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29394">Map</a></td>
<td class="next">
Next: <a href="29441.html">29441</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/72D2.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>