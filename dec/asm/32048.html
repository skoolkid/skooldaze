<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 32048</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31996.html">31996</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32048">Map</a></td>
<td class="next">
Next: <a href="32131.html">32131</a>
</td>
</tr>
</table>
<div class="description">32048: Make a teacher conduct a class without ERIC</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="32178.html">32178</a>. Makes the teacher wipe the board (if there is one), tell the kids what to do, and then walk up and down until the end of the lesson.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Teacher's character number (163-166)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="32048"></span>32048</td>
<td class="instruction">CALL <a href="28968.html">28968</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=identifier of the blackboard the teacher is next to</td>
</tr>
<tr>
<td class="address-1"><span id="32051"></span>32051</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy this to <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="32052"></span>32052</td>
<td class="instruction">CP 236</td>
<td class="comment-1" rowspan="1">Is the teacher on the top floor?</td>
</tr>
<tr>
<td class="address-1"><span id="32054"></span>32054</td>
<td class="instruction">JR NZ,32062</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32056"></span>32056</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="32057"></span>32057</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=teacher's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="32058"></span>32058</td>
<td class="instruction">CP 58</td>
<td class="comment-1" rowspan="1">Is the teacher in the Map Room?</td>
</tr>
<tr>
<td class="address-1"><span id="32060"></span>32060</td>
<td class="instruction">JR NC,32112</td>
<td class="comment-1" rowspan="1">Jump if so (there's no blackboard in the Map Room)</td>
</tr>
<tr>
<td class="address-2"><span id="32062"></span>32062</td>
<td class="instruction">LD BC,29148</td>
<td class="comment-1" rowspan="2">Hand over control to the routine at <a href="29148.html">29148</a>, making the teacher wipe the blackboard</td>
</tr>
<tr>
<td class="address-1"><span id="32065"></span>32065</td>
<td class="instruction">CALL <a href="31985.html">31985</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32068"></span>
<div class="comments">
<div class="paragraph">
Control returns here when the teacher has finished wiping the blackboard.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32068"></span>32068</td>
<td class="instruction">LD L,98</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=teacher's x-coordinate (equal to that of the left edge of the blackboard)</td>
</tr>
<tr>
<td class="address-1"><span id="32070"></span>32070</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32071"></span>32071</td>
<td class="instruction">ADD A,3</td>
<td class="comment-1" rowspan="5">Place the x-coordinate of the middle of the blackboard into byte 107 of the teacher's buffer, and the same value into byte 108 (which ensures that the routine at <a href="25404.html">25404</a> will not relinquish control before the teacher has reached the middle of the blackboard)</td>
</tr>
<tr>
<td class="address-1"><span id="32073"></span>32073</td>
<td class="instruction">LD L,107</td>
</tr>
<tr>
<td class="address-1"><span id="32075"></span>32075</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="32076"></span>32076</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="32077"></span>32077</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="32078"></span>32078</td>
<td class="instruction">LD BC,25404</td>
<td class="comment-1" rowspan="2">Hand over control to the routine at <a href="25404.html">25404</a>, making the teacher walk to the middle of the blackboard</td>
</tr>
<tr>
<td class="address-1"><span id="32081"></span>32081</td>
<td class="instruction">CALL <a href="31985.html">31985</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32084"></span>
<div class="comments">
<div class="paragraph">
Control returns here when the teacher has reached the middle of the blackboard.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32084"></span>32084</td>
<td class="instruction">CALL <a href="24993.html">24993</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="32087"></span>32087</td>
<td class="instruction">CP 160</td>
<td class="comment-1" rowspan="1">Should the teacher write on the blackboard?</td>
</tr>
<tr>
<td class="address-1"><span id="32089"></span>32089</td>
<td class="instruction">JR C,32112</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32091"></span>32091</td>
<td class="instruction">LD BC,29284</td>
<td class="comment-1" rowspan="2">Hand over control to the routine at <a href="29284.html">29284</a>, making the teacher write on the blackboard</td>
</tr>
<tr>
<td class="address-1"><span id="32094"></span>32094</td>
<td class="instruction">CALL <a href="31985.html">31985</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32097"></span>
<div class="comments">
<div class="paragraph">
Control returns here when the teacher has finished writing on the blackboard.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32097"></span>32097</td>
<td class="instruction">CALL <a href="24993.html">24993</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="32100"></span>32100</td>
<td class="instruction">CP 160</td>
<td class="comment-1" rowspan="1">Should the teacher tell the kids to write an essay?</td>
</tr>
<tr>
<td class="address-1"><span id="32102"></span>32102</td>
<td class="instruction">JR C,32112</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32104"></span>32104</td>
<td class="instruction">LD BC,62166</td>
<td class="comment-1" rowspan="1"><a href="62166.html">62166</a>: 'WRITE AN ESSAY WITH THIS TITLE'</td>
</tr>
<tr>
<td class="address-1"><span id="32107"></span>32107</td>
<td class="instruction">CALL <a href="31996.html#32038">32038</a></td>
<td class="comment-1" rowspan="1">Make the teacher tell the kids to write an essay</td>
</tr>
<tr>
<td class="address-1"><span id="32110"></span>32110</td>
<td class="instruction">JR 32115</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="32112"></span>32112</td>
<td class="instruction">CALL <a href="31996.html">31996</a></td>
<td class="comment-1" rowspan="1">Make the teacher tell the kids to go to a page in their books</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32115"></span>
<div class="comments">
<div class="paragraph">
Now we enter a loop that makes the teacher walk up and down next to the blackboard (or the map).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32115"></span>32115</td>
<td class="instruction">LD L,98</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=teacher's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="32117"></span>32117</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32118"></span>32118</td>
<td class="instruction">XOR 3</td>
<td class="comment-1" rowspan="3">Store the x-coordinate of the location 1 or 3 spaces behind the teacher in byte 107 of his buffer</td>
</tr>
<tr>
<td class="address-1"><span id="32120"></span>32120</td>
<td class="instruction">LD L,107</td>
</tr>
<tr>
<td class="address-1"><span id="32122"></span>32122</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="32123"></span>32123</td>
<td class="instruction">LD BC,25404</td>
<td class="comment-1" rowspan="2">Hand over control to the routine at <a href="25404.html">25404</a>, making the teacher turn round and walk 1 or 3 paces</td>
</tr>
<tr>
<td class="address-1"><span id="32126"></span>32126</td>
<td class="instruction">CALL <a href="31985.html">31985</a></td>
</tr>
<tr>
<td class="address-1"><span id="32129"></span>32129</td>
<td class="instruction">JR 32115</td>
<td class="comment-1" rowspan="1">Make the teacher turn round and walk 1 or 3 paces again</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31996.html">31996</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32048">Map</a></td>
<td class="next">
Next: <a href="32131.html">32131</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20191114</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../asm/7D30.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>