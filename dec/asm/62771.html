<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 62771</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62750.html">62750</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62771">Map</a></td>
<td class="next">
Next: <a href="62902.html">62902</a>
</td>
</tr>
</table>
<div class="description">62771: Deal with ERIC when he's jumping</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="27353.html">27353</a> when bit 2 of ERIC's status flags at <a href="32763.html">32763</a> is set (by the routine at <a href="62574.html">62574</a>, via <a href="62617.html">62617</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62771"></span>62771</td>
<td class="instruction">LD HL,32758</td>
<td class="comment-1" rowspan="1">Decrement the jumping action timer at <a href="32758.html">32758</a> (which starts at 16)</td>
</tr>
<tr>
<td class="address-1"><span id="62774"></span>62774</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Has ERIC completed the jump?</td>
</tr>
<tr>
<td class="address-1"><span id="62775"></span>62775</td>
<td class="instruction">JP Z,<a href="62495.html#62501">62501</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="62778"></span>62778</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the current value of the action timer in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-2"><span id="62779"></span>62779</td>
<td class="instruction">CP 12</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="62781"></span>62781</td>
<td class="instruction">LD B,15</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="57056.html">15</a>: YOU ARE NOT A KANGAROO</td>
</tr>
<tr>
<td class="address-1"><span id="62783"></span>62783</td>
<td class="instruction">JP Z,<a href="62495.html#62550">62550</a></td>
<td class="comment-1" rowspan="1">Jump if it's time to check whether any teachers can see ERIC jumping</td>
</tr>
<tr>
<td class="address-1"><span id="62786"></span>62786</td>
<td class="instruction">LD H,172</td>
<td class="comment-1" rowspan="1">172=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="62788"></span>62788</td>
<td class="instruction">CP 13</td>
<td class="comment-1" rowspan="1">Is it time to check whether ERIC has touched a shield or opened the safe?</td>
</tr>
<tr>
<td class="address-1"><span id="62790"></span>62790</td>
<td class="instruction">JP Z,<a href="62750.html">62750</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="62793"></span>62793</td>
<td class="instruction">CP 14</td>
<td class="comment-1" rowspan="1">Is it time to make the jumping sound effect?</td>
</tr>
<tr>
<td class="address-1"><span id="62795"></span>62795</td>
<td class="instruction">JP Z,<a href="60139.html">60139</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="62798"></span>62798</td>
<td class="instruction">CP 9</td>
<td class="comment-1" rowspan="1">Is it time to move ERIC's arm back?</td>
</tr>
<tr>
<td class="address-1"><span id="62800"></span>62800</td>
<td class="instruction">JP Z,<a href="28775.html#28779">28779</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="62803"></span>62803</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="1">Is it time to bring ERIC back down to the floor?</td>
</tr>
<tr>
<td class="address-1"><span id="62805"></span>62805</td>
<td class="instruction">JR NZ,62814</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="62807"></span>62807</td>
<td class="instruction">CALL <a href="25108.html">25108</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's current location</td>
</tr>
<tr>
<td class="address-1"><span id="62810"></span>62810</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move ERIC downwards</td>
</tr>
<tr>
<td class="address-1"><span id="62811"></span>62811</td>
<td class="instruction">JP <a href="25008.html">25008</a></td>
<td class="comment-1" rowspan="1">Update ERIC's location and update the SRB</td>
</tr>
<tr>
<td class="address-2"><span id="62814"></span>62814</td>
<td class="instruction">CP 6</td>
<td class="comment-1" rowspan="2">Return if <span class="register">A</span> &lt; 6 (nothing to check or do)</td>
</tr>
<tr>
<td class="address-1"><span id="62816"></span>62816</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62817"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">A</span>=6 (which means it's time to check whether ERIC has jumped onto a boy, or ERIC is already standing on a boy), or <span class="register">A</span> is one of {7, 8, 10, 11, 15}, or <span class="register">A</span>&gt;128 (which means ERIC has jumped while standing on a boy).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62817"></span>62817</td>
<td class="instruction">JR NZ,62891</td>
<td class="comment-1" rowspan="1">Jump unless (a) it's time to check whether ERIC has jumped on a boy, or (b) ERIC is already standing on a boy</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62819"></span>
<div class="comments">
<div class="paragraph">
This entry point is erroneously used by the routine at <a href="60139.html">60139</a> with <span class="register">H</span>=3 (which means (<span class="register">D</span>,<span class="register">E</span>) is set to (198,32) by the code that follows, and the routine exits at <a href="62771.html#62841">62841</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62819"></span>62819</td>
<td class="instruction">LD L,97</td>
<td class="comment-1" rowspan="1">Byte 97 of ERIC's buffer holds his y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="62821"></span>62821</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="62822"></span>62822</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Down a level (where the boy that ERIC is standing on would be, if any)</td>
</tr>
<tr>
<td class="address-1"><span id="62823"></span>62823</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Byte 98 holds ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="62824"></span>62824</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="62825"></span>62825</td>
<td class="instruction">LD B,11</td>
<td class="comment-1" rowspan="1">There are 11 little boys</td>
</tr>
<tr>
<td class="address-1"><span id="62827"></span>62827</td>
<td class="instruction">LD H,152</td>
<td class="comment-1" rowspan="1">152=little boy no. 1</td>
</tr>
<tr>
<td class="address-1"><span id="62829"></span>62829</td>
<td class="instruction">CALL <a href="62905.html">62905</a></td>
<td class="comment-1" rowspan="1">Is ERIC standing on a little boy?</td>
</tr>
<tr>
<td class="address-1"><span id="62832"></span>62832</td>
<td class="instruction">JR C,62842</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="62834"></span>62834</td>
<td class="instruction">LD H,167</td>
<td class="comment-1" rowspan="1">167=BOY WANDER</td>
</tr>
<tr>
<td class="address-1"><span id="62836"></span>62836</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1">There are three main kids besides ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="62838"></span>62838</td>
<td class="instruction">CALL <a href="62905.html#62911">62911</a></td>
<td class="comment-1" rowspan="1">Is ERIC standing on one of the three main kids?</td>
</tr>
<tr>
<td class="address-1"><span id="62841"></span>62841</td>
<td class="instruction">RET NC</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62842"></span>
<div class="comments">
<div class="paragraph">
ERIC is standing on a kid who's been knocked out.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62842"></span>62842</td>
<td class="instruction">CALL <a href="26426.html">26426</a></td>
<td class="comment-1" rowspan="1">Check for keypresses</td>
</tr>
<tr>
<td class="address-1"><span id="62845"></span>62845</td>
<td class="instruction">LD HL,32758</td>
<td class="comment-1" rowspan="2">Set the jumping action timer at <a href="32758.html">32758</a> to 7, so that we keep returning to this section of code while ERIC is standing on a boy</td>
</tr>
<tr>
<td class="address-1"><span id="62848"></span>62848</td>
<td class="instruction">LD (HL),7</td>
</tr>
<tr>
<td class="address-1"><span id="62850"></span>62850</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if no key of interest was pressed</td>
</tr>
<tr>
<td class="address-1"><span id="62851"></span>62851</td>
<td class="instruction">SET 5,A</td>
<td class="comment-1" rowspan="1">Convert the ASCII code of the keypress in <span class="register">A</span> to lower case</td>
</tr>
<tr>
<td class="address-1"><span id="62853"></span>62853</td>
<td class="instruction">CP 106</td>
<td class="comment-1" rowspan="1">Was 'j' (jump) pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="62855"></span>62855</td>
<td class="instruction">JR NZ,62860</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="62857"></span>62857</td>
<td class="instruction">LD (HL),144</td>
<td class="comment-1" rowspan="1">Set the jumping action timer at <a href="32758.html">32758</a> to 144 to indicate that ERIC has jumped while standing on a boy</td>
</tr>
<tr>
<td class="address-1"><span id="62859"></span>62859</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return to the main loop with the carry flag reset</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62860"></span>
<div class="comments">
<div class="paragraph">
A key other than 'j' was pressed while ERIC was standing on a boy.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62860"></span>62860</td>
<td class="instruction">CP 111</td>
<td class="comment-1" rowspan="1">111='o'</td>
</tr>
<tr>
<td class="address-1"><span id="62862"></span>62862</td>
<td class="instruction">LD B,0</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span>=<a href="../graphics/as.html#0">0</a> (ERIC facing left) for later comparison</td>
</tr>
<tr>
<td class="address-1"><span id="62864"></span>62864</td>
<td class="instruction">JR Z,62871</td>
<td class="comment-1" rowspan="1">Jump if 'o' (left) was pressed</td>
</tr>
<tr>
<td class="address-1"><span id="62866"></span>62866</td>
<td class="instruction">LD B,128</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span>=<a href="../graphics/as.html#128">128</a> (ERIC facing right) for later comparison</td>
</tr>
<tr>
<td class="address-1"><span id="62868"></span>62868</td>
<td class="instruction">CP 112</td>
<td class="comment-1" rowspan="1">Was 'p' (right) pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="62870"></span>62870</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-2"><span id="62871"></span>62871</td>
<td class="instruction">LD HL,44134</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=animatory state of ERIC before he jumped (stored in byte 102 of his buffer)</td>
</tr>
<tr>
<td class="address-1"><span id="62874"></span>62874</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="62875"></span>62875</td>
<td class="instruction">AND 128</td>
<td class="comment-1" rowspan="1">Keep only the 'direction' bit</td>
</tr>
<tr>
<td class="address-1"><span id="62877"></span>62877</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1">Should ERIC turn round?</td>
</tr>
<tr>
<td class="address-1"><span id="62878"></span>62878</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="62879"></span>62879</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Adjust ERIC's pre-jump animatory state to reflect his turning round while standing on a boy</td>
</tr>
<tr>
<td class="address-1"><span id="62880"></span>62880</td>
<td class="instruction">XOR 128</td>
</tr>
<tr>
<td class="address-1"><span id="62882"></span>62882</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="62883"></span>62883</td>
<td class="instruction">CALL <a href="25108.html">25108</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's current animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="62886"></span>62886</td>
<td class="instruction">XOR 128</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=animatory state of ERIC facing the other way</td>
</tr>
<tr>
<td class="address-1"><span id="62888"></span>62888</td>
<td class="instruction">JP <a href="25008.html">25008</a></td>
<td class="comment-1" rowspan="1">Update ERIC's animatory state and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62891"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">A</span> is one of {7, 8, 10, 11, 15} (which means there is nothing to do), or <span class="register">A</span>=128-143 (which means ERIC has jumped while standing on a boy).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62891"></span>62891</td>
<td class="instruction">CP 134</td>
<td class="comment-1" rowspan="2">Return now if the SUB 128 instruction below would make <span class="register">A</span>=6</td>
</tr>
<tr>
<td class="address-1"><span id="62893"></span>62893</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="62894"></span>62894</td>
<td class="instruction">SUB 128</td>
<td class="comment-1" rowspan="2">Return unless ERIC jumped while standing on a boy</td>
</tr>
<tr>
<td class="address-1"><span id="62896"></span>62896</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62897"></span>
<div class="comments">
<div class="paragraph">
So ERIC has jumped while standing on a boy. Now either <span class="register">A</span>=0, meaning it's time to set the jumping action timer at <a href="32758.html">32758</a> back to 7, so we can deal with ERIC while he's standing on a boy; or <span class="register">A</span>=1-15 (but not 6, because that would lead us into the code at <a href="62771.html#62819">62819</a> to perform a redundant check on whether ERIC is standing on a boy), meaning we need to run the usual checks while ERIC is in mid-air.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62897"></span>62897</td>
<td class="instruction">JP NZ,62779</td>
<td class="comment-1" rowspan="1">Run the usual checks while ERIC is in mid-air above a supine boy</td>
</tr>
<tr>
<td class="address-1"><span id="62900"></span>62900</td>
<td class="instruction">JR 62844</td>
<td class="comment-1" rowspan="1">This should be JR <a href="62771.html#62845">62845</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62750.html">62750</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62771">Map</a></td>
<td class="next">
Next: <a href="62902.html">62902</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20200809</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/F533.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>