<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 28569</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28558.html">28558</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28569">Map</a></td>
<td class="next">
Next: <a href="28642.html">28642</a>
</td>
</tr>
</table>
<div class="description">28569: Check whether anyone was punched by ERIC or ANGELFACE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from <a href="28558.html">28558</a>. Also used by the routine at <a href="62628.html">62628</a>. Checks whether anyone was punched by ERIC or ANGELFACE, and knocks them out if so.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">168 (ANGELFACE) or 172 (ERIC)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="28569"></span>28569</td>
<td class="instruction">LD L,98</td>
<td class="comment-1" rowspan="1">Byte 98 of the puncher's buffer holds his x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="28571"></span>28571</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="28572"></span>28572</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=97</td>
</tr>
<tr>
<td class="address-1"><span id="28573"></span>28573</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the puncher's y-coordinate in <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="28574"></span>28574</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=96</td>
</tr>
<tr>
<td class="address-1"><span id="28575"></span>28575</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the puncher's animatory state in <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="28576"></span>28576</td>
<td class="instruction">SUB 2</td>
<td class="comment-1" rowspan="4"><span class="register">A</span>=x-coordinate of the location two spaces in front of the puncher</td>
</tr>
<tr>
<td class="address-1"><span id="28578"></span>28578</td>
<td class="instruction">BIT 7,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="28580"></span>28580</td>
<td class="instruction">JR Z,28584</td>
</tr>
<tr>
<td class="address-1"><span id="28582"></span>28582</td>
<td class="instruction">ADD A,4</td>
</tr>
<tr>
<td class="address-2"><span id="28584"></span>28584</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Store the potential victim's x-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="28585"></span>28585</td>
<td class="instruction">LD A,(32763)</td>
<td class="comment-1" rowspan="1">Collect ERIC's status flags from <a href="32763.html">32763</a></td>
</tr>
<tr>
<td class="address-1"><span id="28588"></span>28588</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is ERIC doing the punching?</td>
</tr>
<tr>
<td class="address-1"><span id="28589"></span>28589</td>
<td class="instruction">JR NZ,28606</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="28591"></span>28591</td>
<td class="instruction">LD H,172</td>
<td class="comment-1" rowspan="1">172=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="28593"></span>28593</td>
<td class="instruction">CALL <a href="28416.html">28416</a></td>
<td class="comment-1" rowspan="1">Was ERIC punched?</td>
</tr>
<tr>
<td class="address-1"><span id="28596"></span>28596</td>
<td class="instruction">JR NC,28606</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="28598"></span>28598</td>
<td class="instruction">LD DE,32763</td>
<td class="comment-1" rowspan="1"><a href="32763.html">32763</a> holds ERIC's status flags</td>
</tr>
<tr>
<td class="address-1"><span id="28601"></span>28601</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28602"></span>28602</td>
<td class="instruction">SET 4,(HL)</td>
<td class="comment-1" rowspan="1">Signal: ERIC was hit</td>
</tr>
<tr>
<td class="address-1"><span id="28604"></span>28604</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28605"></span>28605</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28606"></span>
<div class="comments">
<div class="paragraph">
Now we check whether anyone was punched. We start with the three main kids.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="28606"></span>28606</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1">There are three main kids</td>
</tr>
<tr>
<td class="address-1"><span id="28608"></span>28608</td>
<td class="instruction">LD H,169</td>
<td class="comment-1" rowspan="1">169=EINSTEIN</td>
</tr>
<tr>
<td class="address-2"><span id="28610"></span>28610</td>
<td class="instruction">CALL <a href="28416.html">28416</a></td>
<td class="comment-1" rowspan="1">Was this main kid punched?</td>
</tr>
<tr>
<td class="address-1"><span id="28613"></span>28613</td>
<td class="instruction">JR NC,28626</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-2"><span id="28615"></span>28615</td>
<td class="instruction">LD L,111</td>
<td class="comment-1" rowspan="4">Place the address of the uninterruptible subcommand routine at <a href="27206.html">27206</a> into bytes 111 and 112 of the victim's character buffer</td>
</tr>
<tr>
<td class="address-1"><span id="28617"></span>28617</td>
<td class="instruction">LD (HL),70</td>
</tr>
<tr>
<td class="address-1"><span id="28619"></span>28619</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="28620"></span>28620</td>
<td class="instruction">LD (HL),106</td>
</tr>
<tr>
<td class="address-1"><span id="28622"></span>28622</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Initialise the parameter determining how long the character will stay down (in byte 113)</td>
</tr>
<tr>
<td class="address-1"><span id="28623"></span>28623</td>
<td class="instruction">LD (HL),20</td>
</tr>
<tr>
<td class="address-1"><span id="28625"></span>28625</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="28626"></span>28626</td>
<td class="instruction">DEC H</td>
<td class="comment-1" rowspan="1">Next main kid</td>
</tr>
<tr>
<td class="address-1"><span id="28627"></span>28627</td>
<td class="instruction">DJNZ 28610</td>
<td class="comment-1" rowspan="1">Jump back until three main kids have been considered</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28629"></span>
<div class="comments">
<div class="paragraph">
None of the main kids was hit. What about the little boys?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="28629"></span>28629</td>
<td class="instruction">LD H,152</td>
<td class="comment-1" rowspan="1">152=character number of little boy no. 1</td>
</tr>
<tr>
<td class="address-1"><span id="28631"></span>28631</td>
<td class="instruction">LD B,11</td>
<td class="comment-1" rowspan="1">There are 11 little boys</td>
</tr>
<tr>
<td class="address-2"><span id="28633"></span>28633</td>
<td class="instruction">CALL <a href="28416.html">28416</a></td>
<td class="comment-1" rowspan="1">Was this little boy hit?</td>
</tr>
<tr>
<td class="address-1"><span id="28636"></span>28636</td>
<td class="instruction">JR C,28615</td>
<td class="comment-1" rowspan="1">Knock him over if so</td>
</tr>
<tr>
<td class="address-1"><span id="28638"></span>28638</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Next little boy</td>
</tr>
<tr>
<td class="address-1"><span id="28639"></span>28639</td>
<td class="instruction">DJNZ 28633</td>
<td class="comment-1" rowspan="1">Jump back until all 11 little boys have been considered</td>
</tr>
<tr>
<td class="address-1"><span id="28641"></span>28641</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28558.html">28558</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28569">Map</a></td>
<td class="next">
Next: <a href="28642.html">28642</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/6F99.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>