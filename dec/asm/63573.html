<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 63573</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63488.html">63488</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63573">Map</a></td>
<td class="next">
Next: <a href="63666.html">63666</a>
</td>
</tr>
</table>
<div class="description">63573: Generate a safe combination code and set MR CREAK's birth year</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="63668.html">63668</a>. Generates a new safe combination code, sets a new random birth year for MR CREAK, and adjusts the game mode (so that all the shields need to be flashed again).
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">0</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="63573"></span>63573</td>
<td class="instruction">LD HL,32696</td>
<td class="comment-1" rowspan="5">Clear the safe combination code (stored at <a href="32671.html">32671</a>), the teachers' combination letters (stored at <a href="32675.html">32675</a>), and the blackboard contents buffers (at <a href="32680.html">32680</a>, <a href="32686.html">32686</a> and <a href="32692.html">32692</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="63576"></span>63576</td>
<td class="instruction">LD B,25</td>
</tr>
<tr>
<td class="address-2"><span id="63578"></span>63578</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="63579"></span>63579</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="63580"></span>63580</td>
<td class="instruction">DJNZ 63578</td>
</tr>
<tr>
<td class="address-1"><span id="63582"></span>63582</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="2"><span class="register">DE</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="63583"></span>63583</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="63584"></span>63584</td>
<td class="instruction">LD C,4</td>
<td class="comment-1" rowspan="1">There are four letters in the combination</td>
</tr>
<tr>
<td class="address-1"><span id="63586"></span>63586</td>
<td class="instruction">CALL <a href="24993.html">24993</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="63589"></span>63589</td>
<td class="instruction">AND 15</td>
<td class="comment-1" rowspan="1">0&lt;=<span class="register">A</span>&lt;=15</td>
</tr>
<tr>
<td class="address-1"><span id="63591"></span>63591</td>
<td class="instruction">JR 63612</td>
<td class="comment-1" rowspan="1">Store MR WACKER's safe combination letter first (at <a href="32671.html">32671</a>)</td>
</tr>
<tr>
<td class="address-2"><span id="63593"></span>63593</td>
<td class="instruction">LD L,159</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32671.html">32671</a> (first letter of the safe combination code)</td>
</tr>
<tr>
<td class="address-1"><span id="63595"></span>63595</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32671.html">32671</a>+<span class="register">C</span> (1&lt;=<span class="register">C</span>&lt;=3)</td>
</tr>
<tr>
<td class="address-2"><span id="63596"></span>63596</td>
<td class="instruction">CALL <a href="24993.html">24993</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="63599"></span>63599</td>
<td class="instruction">LD E,B</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="63600"></span>63600</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="4">Get a random number between 0 and 3 in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="63601"></span>63601</td>
<td class="instruction">RL E</td>
</tr>
<tr>
<td class="address-1"><span id="63603"></span>63603</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="63604"></span>63604</td>
<td class="instruction">RL E</td>
</tr>
<tr>
<td class="address-1"><span id="63606"></span>63606</td>
<td class="instruction">AND 31</td>
<td class="comment-1" rowspan="2">Is <span class="register">A</span> between 0 and 25?</td>
</tr>
<tr>
<td class="address-1"><span id="63608"></span>63608</td>
<td class="instruction">CP 26</td>
</tr>
<tr>
<td class="address-1"><span id="63610"></span>63610</td>
<td class="instruction">JR NC,63596</td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="address-2"><span id="63612"></span>63612</td>
<td class="instruction">ADD A,65</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ASCII code of an upper case letter</td>
</tr>
<tr>
<td class="address-1"><span id="63614"></span>63614</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store this in one of the slots at <a href="32671.html">32671</a></td>
</tr>
<tr>
<td class="address-1"><span id="63615"></span>63615</td>
<td class="instruction">LD L,163</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at a random teacher's safe combination letter</td>
</tr>
<tr>
<td class="address-1"><span id="63617"></span>63617</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63618"></span>63618</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-1" rowspan="1">Has this letter already been decided?</td>
</tr>
<tr>
<td class="address-1"><span id="63620"></span>63620</td>
<td class="instruction">JR NZ,63593</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="63622"></span>63622</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store the ASCII code in one of the four slots at <a href="32675.html">32675</a></td>
</tr>
<tr>
<td class="address-1"><span id="63623"></span>63623</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Next combination letter</td>
</tr>
<tr>
<td class="address-1"><span id="63624"></span>63624</td>
<td class="instruction">JR NZ,63593</td>
<td class="comment-1" rowspan="1">Jump back until all four combination letters are done</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63626"></span>
<div class="comments">
<div class="paragraph">
The safe combination code has been generated. Now for MR CREAK's birth year.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63626"></span>63626</td>
<td class="instruction">LD L,154</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32666.html">32666</a> (which holds the identifier for CREAK's birth year battle)</td>
</tr>
<tr>
<td class="address-2"><span id="63628"></span>63628</td>
<td class="instruction">CALL <a href="24993.html">24993</a></td>
<td class="comment-1" rowspan="3">Get a random number between 0 and 20 in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="63631"></span>63631</td>
<td class="instruction">CP 21</td>
</tr>
<tr>
<td class="address-1"><span id="63633"></span>63633</td>
<td class="instruction">JR NC,63628</td>
</tr>
<tr>
<td class="address-1"><span id="63635"></span>63635</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=random odd number between 213 and 253</td>
</tr>
<tr>
<td class="address-1"><span id="63636"></span>63636</td>
<td class="instruction">ADD A,213</td>
</tr>
<tr>
<td class="address-1"><span id="63638"></span>63638</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store this battle identifier at <a href="32666.html">32666</a></td>
</tr>
<tr>
<td class="address-1"><span id="63639"></span>63639</td>
<td class="instruction">SUB 129</td>
<td class="comment-1" rowspan="12">Set <span class="register">HL</span> to the address of the battle year message corresponding to this battle identifier</td>
</tr>
<tr>
<td class="address-1"><span id="63641"></span>63641</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="63642"></span>63642</td>
<td class="instruction">LD H,D</td>
</tr>
<tr>
<td class="address-1"><span id="63643"></span>63643</td>
<td class="instruction">LD L,D</td>
</tr>
<tr>
<td class="address-1"><span id="63644"></span>63644</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63645"></span>63645</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63646"></span>63646</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63647"></span>63647</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="63648"></span>63648</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="63649"></span>63649</td>
<td class="instruction">LD A,H</td>
</tr>
<tr>
<td class="address-1"><span id="63650"></span>63650</td>
<td class="instruction">ADD A,223</td>
</tr>
<tr>
<td class="address-1"><span id="63652"></span>63652</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="63653"></span>63653</td>
<td class="instruction">LD DE,32667</td>
<td class="comment-1" rowspan="3">Store the digits of CREAK's birth year at <a href="32667.html">32667</a></td>
</tr>
<tr>
<td class="address-1"><span id="63656"></span>63656</td>
<td class="instruction">LD C,4</td>
</tr>
<tr>
<td class="address-1"><span id="63658"></span>63658</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63660"></span>
<div class="comments">
<div class="paragraph">
Finally, adjust the game mode.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63660"></span>63660</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="2">Set the game mode indicator at <a href="32746.html">32746</a> to 1, indicating that the shields need to be flashed</td>
</tr>
<tr>
<td class="address-1"><span id="63662"></span>63662</td>
<td class="instruction">LD (32746),A</td>
</tr>
<tr>
<td class="address-1"><span id="63665"></span>63665</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63488.html">63488</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63573">Map</a></td>
<td class="next">
Next: <a href="63666.html">63666</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20200809</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/F855.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>