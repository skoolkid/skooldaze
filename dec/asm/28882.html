<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 28882</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28807.html">28807</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28882">Map</a></td>
<td class="next">
Next: <a href="28960.html">28960</a>
</td>
</tr>
</table>
<div class="description">28882: Get the next character of a message being spoken or written</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="28994.html">28994</a> and <a href="29706.html">29706</a>. Returns with the next character in <span class="register">A</span>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Number of the character speaking or writing (152-169)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="28882"></span>28882</td>
<td class="instruction">LD L,110</td>
<td class="comment-1" rowspan="2">Bytes 109 and 110 of the character's buffer hold the address of the next character in the submessage</td>
</tr>
<tr>
<td class="address-1"><span id="28884"></span>28884</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="28885"></span>28885</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Are we in a submessage at the moment?</td>
</tr>
<tr>
<td class="address-1"><span id="28886"></span>28886</td>
<td class="instruction">JR Z,28904</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="28888"></span>28888</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="3"><span class="register">DE</span>=address of the next character in the submessage</td>
</tr>
<tr>
<td class="address-1"><span id="28889"></span>28889</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="28890"></span>28890</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="28891"></span>28891</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up this character in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="28892"></span>28892</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Has the submessage finished?</td>
</tr>
<tr>
<td class="address-1"><span id="28893"></span>28893</td>
<td class="instruction">JR Z,28901</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="28895"></span>28895</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="28896"></span>28896</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="4">Move to the next character in the submessage, and store its address in bytes 109 and 110 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="28897"></span>28897</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="28898"></span>28898</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="28899"></span>28899</td>
<td class="instruction">LD (HL),D</td>
</tr>
<tr>
<td class="address-1"><span id="28900"></span>28900</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28901"></span>
<div class="comments">
<div class="paragraph">
The submessage has finished.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="28901"></span>28901</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="3">Zero out bytes 109 and 110 of the character's buffer to indicate that the submessage is finished</td>
</tr>
<tr>
<td class="address-1"><span id="28902"></span>28902</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="28903"></span>28903</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28904"></span>
<div class="comments">
<div class="paragraph">
We are dealing with the main message.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="28904"></span>28904</td>
<td class="instruction">LD L,108</td>
<td class="comment-1" rowspan="4"><span class="register">DE</span>=address of the next character in the main message (collected from bytes 107 and 108 of the character's buffer)</td>
</tr>
<tr>
<td class="address-1"><span id="28906"></span>28906</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="28907"></span>28907</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="28908"></span>28908</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="28909"></span>28909</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up the next character of the message</td>
</tr>
<tr>
<td class="address-1"><span id="28910"></span>28910</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="4">Move to the next character in the main message, and store its address in bytes 107 and 108 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="28911"></span>28911</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="28912"></span>28912</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="28913"></span>28913</td>
<td class="instruction">LD (HL),D</td>
</tr>
<tr>
<td class="address-1"><span id="28914"></span>28914</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=109</td>
</tr>
<tr>
<td class="address-1"><span id="28915"></span>28915</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-1" rowspan="1">Is the ASCII code of the next character &lt; 128?</td>
</tr>
<tr>
<td class="address-1"><span id="28917"></span>28917</td>
<td class="instruction">JR Z,28938</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28919"></span>
<div class="comments">
<div class="paragraph">
The ASCII code of the next character is &gt;= 128, which refers to an entry in one of the symbol/element, capital city/country and date/battle question-and-answer pairs.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="28919"></span>28919</td>
<td class="instruction">AND 127</td>
<td class="comment-1" rowspan="13">Set <span class="register">DE</span> to <a href="57088.html">57088</a>+12*(<span class="register">A</span>-128)</td>
</tr>
<tr>
<td class="address-1"><span id="28921"></span>28921</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="28922"></span>28922</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="28923"></span>28923</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="28924"></span>28924</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="address-1"><span id="28925"></span>28925</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="28926"></span>28926</td>
<td class="instruction">LD H,56</td>
</tr>
<tr>
<td class="address-1"><span id="28928"></span>28928</td>
<td class="instruction">JR NC,28931</td>
</tr>
<tr>
<td class="address-1"><span id="28930"></span>28930</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-2"><span id="28931"></span>28931</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="28932"></span>28932</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="28933"></span>28933</td>
<td class="instruction">DEC H</td>
</tr>
<tr>
<td class="address-1"><span id="28934"></span>28934</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="28935"></span>28935</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">Pick up the first character of this submessage in <span class="register">A</span> and store the next address in bytes 109 and 110 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="28936"></span>28936</td>
<td class="instruction">JR 28896</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28938"></span>
<div class="comments">
<div class="paragraph">
The ASCII code of the next character in the message is &lt; 128.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="28938"></span>28938</td>
<td class="instruction">CP 32</td>
<td class="comment-1" rowspan="2">Return if the next character is a normal, printable character (ASCII code &gt;= 32)</td>
</tr>
<tr>
<td class="address-1"><span id="28940"></span>28940</td>
<td class="instruction">RET NC</td>
</tr>
<tr>
<td class="address-1"><span id="28941"></span>28941</td>
<td class="instruction">CP 16</td>
<td class="comment-1" rowspan="2">Return if the ASCII code of the next character in the message is &lt; 16</td>
</tr>
<tr>
<td class="address-1"><span id="28943"></span>28943</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28944"></span>
<div class="comments">
<div class="paragraph">
The ASCII code of the next character in the message is 16-24. We have a submessage to deal with, which will be one of the following:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Code</th>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Submessage</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">16</td>
<td class="centre" colspan="1" rowspan="1"><a href="55680.html">55680</a></td>
<td class="" colspan="1" rowspan="1">'ERIC'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">17</td>
<td class="centre" colspan="1" rowspan="1"><a href="55694.html">55694</a></td>
<td class="" colspan="1" rowspan="1">'BOY WANDER'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">18</td>
<td class="centre" colspan="1" rowspan="1"><a href="55708.html">55708</a></td>
<td class="" colspan="1" rowspan="1">'ANGELFACE'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">19</td>
<td class="centre" colspan="1" rowspan="1"><a href="55722.html">55722</a></td>
<td class="" colspan="1" rowspan="1">'EINSTEIN'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">20</td>
<td class="centre" colspan="1" rowspan="1"><a href="55736.html">55736</a></td>
<td class="" colspan="1" rowspan="1">'MR WACKER'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">21</td>
<td class="centre" colspan="1" rowspan="1"><a href="55750.html">55750</a></td>
<td class="" colspan="1" rowspan="1">'MR ROCKITT'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">22</td>
<td class="centre" colspan="1" rowspan="1"><a href="55764.html">55764</a></td>
<td class="" colspan="1" rowspan="1">'MR WITHIT'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">23</td>
<td class="centre" colspan="1" rowspan="1"><a href="55778.html">55778</a></td>
<td class="" colspan="1" rowspan="1">'MR CREAK'</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">24</td>
<td class="centre" colspan="1" rowspan="1"><a href="55792.html">55792</a></td>
<td class="" colspan="1" rowspan="1">'Please Sir - I cannot tell a lie . . '</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="28944"></span>28944</td>
<td class="instruction">SUB 16</td>
<td class="comment-1" rowspan="10">Point <span class="register">DE</span> at the appropriate submessage from the table above</td>
</tr>
<tr>
<td class="address-1"><span id="28946"></span>28946</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="28947"></span>28947</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="28948"></span>28948</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="28949"></span>28949</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="28950"></span>28950</td>
<td class="instruction">SUB E</td>
</tr>
<tr>
<td class="address-1"><span id="28951"></span>28951</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="28952"></span>28952</td>
<td class="instruction">ADD A,128</td>
</tr>
<tr>
<td class="address-1"><span id="28954"></span>28954</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="28955"></span>28955</td>
<td class="instruction">LD D,217</td>
</tr>
<tr>
<td class="address-1"><span id="28957"></span>28957</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up the first character of the submessage in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="28958"></span>28958</td>
<td class="instruction">JR 28896</td>
<td class="comment-1" rowspan="1">Store the address of the next character in the submessage</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28807.html">28807</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28882">Map</a></td>
<td class="next">
Next: <a href="28960.html">28960</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/70D2.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>