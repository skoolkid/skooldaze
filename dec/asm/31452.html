<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 31452</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31447.html">31447</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31452">Map</a></td>
<td class="next">
Next: <a href="31637.html">31637</a>
</td>
</tr>
</table>
<div class="description">31452: Determine the next move of a character following another character</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="31648.html">31648</a>, <a href="62938.html">62938</a> and <a href="63374.html">63374</a>. Returns with one of the following values in <span class="register">A</span> depending on the relative locations of the follower and his target:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">A</th>
<th colspan="1" rowspan="1">Meaning</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">0</td>
<td class="" colspan="1" rowspan="1">Follower is at the same coordinates as the target</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">1</td>
<td class="" colspan="1" rowspan="1">Follower should go (or continue going) upstairs</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">Follower should go (or continue going) downstairs</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">Follower should go left</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Follower should go right</td>
</tr>
</table>
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Target character's coordinates</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Follower's character number (152-172)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="31452"></span>31452</td>
<td class="instruction">LD L,97</td>
<td class="comment-1" rowspan="1">Byte 97 of the follower's buffer holds his y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31454"></span>31454</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="31455"></span>31455</td>
<td class="instruction">CP 155</td>
<td class="comment-1" rowspan="1">Is the follower on the top floor?</td>
</tr>
<tr>
<td class="address-1"><span id="31457"></span>31457</td>
<td class="instruction">JR Z,31480</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31459"></span>31459</td>
<td class="instruction">CP 162</td>
<td class="comment-1" rowspan="1">Is the follower on the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="31461"></span>31461</td>
<td class="instruction">JR Z,31480</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31463"></span>31463</td>
<td class="instruction">CP 169</td>
<td class="comment-1" rowspan="1">Is the follower on the bottom floor?</td>
</tr>
<tr>
<td class="address-1"><span id="31465"></span>31465</td>
<td class="instruction">JR Z,31480</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31467"></span>
<div class="comments">
<div class="paragraph">
The follower is on a staircase. Find out whether he's going up or down and set <span class="register">A</span> accordingly to make him continue.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="31467"></span>31467</td>
<td class="instruction">LD L,98</td>
<td class="comment-1" rowspan="1">Byte 98 of the follower's buffer holds his x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31469"></span>31469</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="31470"></span>31470</td>
<td class="instruction">LD L,96</td>
<td class="comment-1" rowspan="1">Byte 96 holds the follower's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="31472"></span>31472</td>
<td class="instruction">ADD A,80</td>
<td class="comment-1" rowspan="1">Set bit 7 of <span class="register">A</span> if the follower is on a staircase at the right of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31474"></span>31474</td>
<td class="instruction">XOR (HL)</td>
<td class="comment-1" rowspan="4"><span class="register">A</span>=1 if the follower is going upstairs, 2 if he's going downstairs</td>
</tr>
<tr>
<td class="address-1"><span id="31475"></span>31475</td>
<td class="instruction">AND 128</td>
</tr>
<tr>
<td class="address-1"><span id="31477"></span>31477</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="31478"></span>31478</td>
<td class="instruction">INC A</td>
</tr>
<tr>
<td class="address-1"><span id="31479"></span>31479</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31480"></span>
<div class="comments">
<div class="paragraph">
The follower is not on a staircase. Which way should he go?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31480"></span>31480</td>
<td class="instruction">CP D</td>
<td class="comment-1" rowspan="1">Is the follower on the same floor as the target?</td>
</tr>
<tr>
<td class="address-1"><span id="31481"></span>31481</td>
<td class="instruction">JR NZ,31549</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31483"></span>
<div class="comments">
<div class="paragraph">
The follower is on the same floor as the target. However, there may be a wall between them.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="31483"></span>31483</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Pick up the follower's x-coordinate in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="31484"></span>31484</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31485"></span>31485</td>
<td class="instruction">SUB E</td>
<td class="comment-1" rowspan="1">Is the follower in the same spot as his target?</td>
</tr>
<tr>
<td class="address-1"><span id="31486"></span>31486</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="31487"></span>31487</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="2">Pick up the follower's y-coordinate in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="31488"></span>31488</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31489"></span>31489</td>
<td class="instruction">CP 169</td>
<td class="comment-1" rowspan="1">Is the follower on the bottom floor?</td>
</tr>
<tr>
<td class="address-1"><span id="31491"></span>31491</td>
<td class="instruction">JR NZ,31501</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31493"></span>
<div class="comments">
<div class="paragraph">
The follower and target are both on the bottom floor, so the follower should simply move either left or right.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="31493"></span>31493</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-2"><span id="31494"></span>31494</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=follower's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31495"></span>31495</td>
<td class="instruction">CP E</td>
<td class="comment-1" rowspan="1">Set the carry flag if the follower should go right</td>
</tr>
<tr>
<td class="address-2"><span id="31496"></span>31496</td>
<td class="instruction">LD A,3</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=3 if the follower should go left, 4 if he should go right</td>
</tr>
<tr>
<td class="address-1"><span id="31498"></span>31498</td>
<td class="instruction">ADC A,0</td>
</tr>
<tr>
<td class="address-1"><span id="31500"></span>31500</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31501"></span>
<div class="comments">
<div class="paragraph">
The follower and target are both on the middle floor or both on the top floor.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31501"></span>31501</td>
<td class="instruction">CP 162</td>
<td class="comment-1" rowspan="1">Set the zero flag if the follower and target are on the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="31503"></span>31503</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="31504"></span>31504</td>
<td class="instruction">LD A,57</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the Reading and Map Rooms</td>
</tr>
<tr>
<td class="address-1"><span id="31506"></span>31506</td>
<td class="instruction">JR NZ,31510</td>
<td class="comment-1" rowspan="1">Jump if the follower and target are on the top floor</td>
</tr>
<tr>
<td class="address-1"><span id="31508"></span>31508</td>
<td class="instruction">LD A,38</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the White and Exam Rooms</td>
</tr>
<tr>
<td class="address-2"><span id="31510"></span>31510</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare the follower's x-coordinate with that of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31511"></span>31511</td>
<td class="instruction">JR C,31531</td>
<td class="comment-1" rowspan="1">Jump if the follower is to the right of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31513"></span>31513</td>
<td class="instruction">CP E</td>
<td class="comment-1" rowspan="1">Is the target character to the left of the wall?</td>
</tr>
<tr>
<td class="address-1"><span id="31514"></span>31514</td>
<td class="instruction">JR NC,31494</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31516"></span>
<div class="comments">
<div class="paragraph">
The follower is on the left side of the skool and must go downstairs to get to the target on the other side of the skool.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31516"></span>31516</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=follower's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31517"></span>31517</td>
<td class="instruction">CP 12</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the tops of the staircases at the left of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31519"></span>31519</td>
<td class="instruction">JR NZ,31496</td>
<td class="comment-1" rowspan="1">Jump unless the follower is at the top of a staircase</td>
</tr>
<tr>
<td class="address-1"><span id="31521"></span>31521</td>
<td class="instruction">LD L,96</td>
<td class="comment-1" rowspan="1">Byte 96 of the follower's buffer holds his animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="31523"></span>31523</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=4 will make the follower turn round if facing left</td>
</tr>
<tr>
<td class="address-1"><span id="31525"></span>31525</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the follower facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="31527"></span>31527</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="31528"></span>31528</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=2 will make the follower go down the stairs</td>
</tr>
<tr>
<td class="address-1"><span id="31530"></span>31530</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31531"></span>
<div class="comments">
<div class="paragraph">
The follower is on the right side of the skool. Is the target there too?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31531"></span>31531</td>
<td class="instruction">CP E</td>
<td class="comment-1" rowspan="1">Is the target character to the right of the wall?</td>
</tr>
<tr>
<td class="address-1"><span id="31532"></span>31532</td>
<td class="instruction">JR C,31494</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-2"><span id="31534"></span>31534</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=follower's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31535"></span>31535</td>
<td class="instruction">CP 77</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the tops of the staircases at the right of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31537"></span>31537</td>
<td class="instruction">JR NZ,31496</td>
<td class="comment-1" rowspan="1">Jump unless the follower is at the top of a staircase</td>
</tr>
<tr>
<td class="address-1"><span id="31539"></span>31539</td>
<td class="instruction">LD L,96</td>
<td class="comment-1" rowspan="1">Byte 96 of the follower's buffer holds his animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="31541"></span>31541</td>
<td class="instruction">LD A,3</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=3 will make the follower turn round if facing right</td>
</tr>
<tr>
<td class="address-1"><span id="31543"></span>31543</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the follower facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="31545"></span>31545</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="31546"></span>31546</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=2 will make the follower go down the stairs</td>
</tr>
<tr>
<td class="address-1"><span id="31548"></span>31548</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31549"></span>
<div class="comments">
<div class="paragraph">
The follower and target are on different floors.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31549"></span>31549</td>
<td class="instruction">JR NC,31565</td>
<td class="comment-1" rowspan="1">Jump if the target is on a floor above the follower</td>
</tr>
<tr>
<td class="address-1"><span id="31551"></span>31551</td>
<td class="instruction">CP 162</td>
<td class="comment-1" rowspan="1">Set the zero flag if the follower is on the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="31553"></span>31553</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="31554"></span>31554</td>
<td class="instruction">LD A,57</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the Reading and Map Rooms</td>
</tr>
<tr>
<td class="address-1"><span id="31556"></span>31556</td>
<td class="instruction">JR NZ,31560</td>
<td class="comment-1" rowspan="1">Jump if the follower is on the top floor</td>
</tr>
<tr>
<td class="address-1"><span id="31558"></span>31558</td>
<td class="instruction">LD A,38</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the White and Exam Rooms</td>
</tr>
<tr>
<td class="address-2"><span id="31560"></span>31560</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare the follower's x-coordinate with that of the wall</td>
</tr>
<tr>
<td class="address-2"><span id="31561"></span>31561</td>
<td class="instruction">JR NC,31516</td>
<td class="comment-1" rowspan="1">Jump if the follower is to the left of the wall (and so needs to go to the top of a staircase on the left)</td>
</tr>
<tr>
<td class="address-1"><span id="31563"></span>31563</td>
<td class="instruction">JR C,31534</td>
<td class="comment-1" rowspan="1">Jump if the follower is to the right of the wall (and so needs to go to the top of a staircase on the right)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31565"></span>
<div class="comments">
<div class="paragraph">
The target is on a floor above the follower. Which staircase should the follower use?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31565"></span>31565</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=target's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31566"></span>31566</td>
<td class="instruction">LD D,155</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the top floor</td>
</tr>
<tr>
<td class="address-1"><span id="31568"></span>31568</td>
<td class="instruction">CP 162</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="31570"></span>31570</td>
<td class="instruction">LD A,57</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the Reading and Map Rooms</td>
</tr>
<tr>
<td class="address-1"><span id="31572"></span>31572</td>
<td class="instruction">JR C,31578</td>
<td class="comment-1" rowspan="1">Jump if the target is above the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="31574"></span>31574</td>
<td class="instruction">LD D,162</td>
<td class="comment-1" rowspan="1">This is the y-coordinate of the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="31576"></span>31576</td>
<td class="instruction">LD A,38</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the White and Exam Rooms</td>
</tr>
<tr>
<td class="address-2"><span id="31578"></span>31578</td>
<td class="instruction">CP E</td>
<td class="comment-1" rowspan="1">Compare the target's x-coordinate with that of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31579"></span>31579</td>
<td class="instruction">LD E,97</td>
<td class="comment-1" rowspan="1">Signal: target is to the right of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31581"></span>31581</td>
<td class="instruction">JR C,31585</td>
<td class="comment-1" rowspan="1">Jump if the target is to the right of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31583"></span>31583</td>
<td class="instruction">LD E,1</td>
<td class="comment-1" rowspan="1">Signal: target is to the left of the wall</td>
</tr>
<tr>
<td class="address-2"><span id="31585"></span>31585</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=follower's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31586"></span>31586</td>
<td class="instruction">CP 169</td>
<td class="comment-1" rowspan="1">Set the zero flag if the follower is on the bottom floor</td>
</tr>
<tr>
<td class="address-1"><span id="31588"></span>31588</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="address-1"><span id="31589"></span>31589</td>
<td class="instruction">JR NZ,31622</td>
<td class="comment-1" rowspan="1">Jump if the follower is on the middle floor</td>
</tr>
<tr>
<td class="address-2"><span id="31591"></span>31591</td>
<td class="instruction">LD A,19</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottoms of the staircases at the left of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31593"></span>31593</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1">Is the target to the left of the wall?</td>
</tr>
<tr>
<td class="address-1"><span id="31594"></span>31594</td>
<td class="instruction">JR Z,31598</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31596"></span>31596</td>
<td class="instruction">LD A,70</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottoms of the staircases at the right of the skool</td>
</tr>
<tr>
<td class="address-2"><span id="31598"></span>31598</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare this with the follower's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31599"></span>31599</td>
<td class="instruction">CCF</td>
<td class="comment-1" rowspan="1">Set the carry flag if the follower should go right</td>
</tr>
<tr>
<td class="address-1"><span id="31600"></span>31600</td>
<td class="instruction">JR NZ,31496</td>
<td class="comment-1" rowspan="1">Jump if the follower is not at the bottom of a staircase</td>
</tr>
<tr>
<td class="address-1"><span id="31602"></span>31602</td>
<td class="instruction">LD L,96</td>
<td class="comment-1" rowspan="1">Byte 96 of the follower's buffer holds his animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="31604"></span>31604</td>
<td class="instruction">CP 19</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottoms of the staircases at the left of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31606"></span>31606</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=1 will make the follower go upstairs</td>
</tr>
<tr>
<td class="address-1"><span id="31608"></span>31608</td>
<td class="instruction">JR Z,31616</td>
<td class="comment-1" rowspan="1">Jump if the follower should go up a staircase at the left of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31610"></span>31610</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the follower facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="31612"></span>31612</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31613"></span>31613</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=3 will make the follower turn round and face right</td>
</tr>
<tr>
<td class="address-1"><span id="31615"></span>31615</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="31616"></span>31616</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the follower facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="31618"></span>31618</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return (with <span class="register">A</span>=1) if so</td>
</tr>
<tr>
<td class="address-1"><span id="31619"></span>31619</td>
<td class="instruction">LD A,3</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=3 will make the follower turn round and face left</td>
</tr>
<tr>
<td class="address-1"><span id="31621"></span>31621</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31622"></span>
<div class="comments">
<div class="paragraph">
The follower is on the middle floor, and the target is on the top floor.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31622"></span>31622</td>
<td class="instruction">LD A,38</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the wall between the White and Exam Rooms</td>
</tr>
<tr>
<td class="address-1"><span id="31624"></span>31624</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare this with the follower's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31625"></span>31625</td>
<td class="instruction">LD A,97</td>
<td class="comment-1" rowspan="1">Signal: follower is to the right of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31627"></span>31627</td>
<td class="instruction">JR C,31631</td>
<td class="comment-1" rowspan="1">Jump if the follower is to the right of the wall</td>
</tr>
<tr>
<td class="address-1"><span id="31629"></span>31629</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="1">Signal: follower is to the left of the wall</td>
</tr>
<tr>
<td class="address-2"><span id="31631"></span>31631</td>
<td class="instruction">CP E</td>
<td class="comment-1" rowspan="1">Is the target on the same side of the skool?</td>
</tr>
<tr>
<td class="address-1"><span id="31632"></span>31632</td>
<td class="instruction">JR Z,31591</td>
<td class="comment-1" rowspan="1">Jump if so (follower must go up the nearest staircase)</td>
</tr>
<tr>
<td class="address-1"><span id="31634"></span>31634</td>
<td class="instruction">CCF</td>
<td class="comment-1" rowspan="1">Set the carry flag if the follower must go down a staircase at the right of the skool, and reset it if he must go down a staircase at the left of the skool</td>
</tr>
<tr>
<td class="address-1"><span id="31635"></span>31635</td>
<td class="instruction">JR 31561</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31447.html">31447</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31452">Map</a></td>
<td class="next">
Next: <a href="31637.html">31637</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20200809</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/7ADC.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>