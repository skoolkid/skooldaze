<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 31985</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31968.html">31968</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31985">Map</a></td>
<td class="next">
Next: <a href="31996.html">31996</a>
</td>
</tr>
</table>
<div class="description">31985: Call an interruptible subcommand</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="31996.html">31996</a>, <a href="32048.html">32048</a>, <a href="32158.html">32158</a>, <a href="62208.html">62208</a> and <a href="62464.html">62464</a>. Drops the return address from the stack and copies its LSB into byte 99 of the character's buffer (where the LSB of the address of the primary command routine is held), copies the address of the interruptible subcommand routine from <span class="register">BC</span> into bytes 106 and 107 of the character's buffer, and then jumps to that routine.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">BC</td>
<td class="register-desc">Interruptible subcommand routine address</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (152-169)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="31985"></span>31985</td>
<td class="instruction">LD L,106</td>
<td class="comment-1" rowspan="4">Copy the routine address from <span class="register">BC</span> into bytes 105 and 106 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="31987"></span>31987</td>
<td class="instruction">LD (HL),B</td>
</tr>
<tr>
<td class="address-1"><span id="31988"></span>31988</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="31989"></span>31989</td>
<td class="instruction">LD (HL),C</td>
</tr>
<tr>
<td class="address-1"><span id="31990"></span>31990</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="3">Drop the return address off the stack and place its LSB into byte 99 of the character's buffer; this ensures that when the interruptible subcommand has finished, control resumes in the caller of this routine</td>
</tr>
<tr>
<td class="address-1"><span id="31991"></span>31991</td>
<td class="instruction">LD L,99</td>
</tr>
<tr>
<td class="address-1"><span id="31993"></span>31993</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="31994"></span>31994</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Make an indirect jump to the routine address in <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="31995"></span>31995</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31968.html">31968</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31985">Map</a></td>
<td class="next">
Next: <a href="31996.html">31996</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/7CF1.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>