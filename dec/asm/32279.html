<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 32279</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32263.html">32263</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32279">Map</a></td>
<td class="next">
Next: <a href="32353.html">32353</a>
</td>
</tr>
</table>
<div class="description">32279: Play a tune</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="32390.html">32390</a>, <a href="32400.html">32400</a>, <a href="32406.html">32406</a> and <a href="32418.html">32418</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Base address of the tune data table</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="32279"></span>32279</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts</td>
</tr>
<tr>
<td class="address-2"><span id="32280"></span>32280</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up a tune datum in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="32281"></span>32281</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next tune datum</td>
</tr>
<tr>
<td class="address-1"><span id="32282"></span>32282</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is the tune finished?</td>
</tr>
<tr>
<td class="address-1"><span id="32283"></span>32283</td>
<td class="instruction">JR NZ,32290</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32285"></span>32285</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="2">Make the border blue</td>
</tr>
<tr>
<td class="address-1"><span id="32286"></span>32286</td>
<td class="instruction">OUT (254),A</td>
</tr>
<tr>
<td class="address-1"><span id="32288"></span>32288</td>
<td class="instruction">EI</td>
<td class="comment-1" rowspan="1">Re-enable interrupts</td>
</tr>
<tr>
<td class="address-1"><span id="32289"></span>32289</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32290"></span>
<div class="comments">
<div class="paragraph">
A non-zero tune datum has been found, meaning the tune is not finished yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32290"></span>32290</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32291"></span>32291</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Copy the tune datum to <span class="register">B</span></td>
</tr>
<tr>
<td class="address-1"><span id="32292"></span>32292</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Should we pause briefly (bit 0 set) here?</td>
</tr>
<tr>
<td class="address-1"><span id="32293"></span>32293</td>
<td class="instruction">JR NC,32304</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32295"></span>32295</td>
<td class="instruction">LD DE,3840</td>
<td class="comment-1" rowspan="5">Pause briefly (this happens for all but one note in the theme tune, and for all notes in the 'all shields/safe' tune)</td>
</tr>
<tr>
<td class="address-2"><span id="32298"></span>32298</td>
<td class="instruction">DEC E</td>
</tr>
<tr>
<td class="address-1"><span id="32299"></span>32299</td>
<td class="instruction">JR NZ,32298</td>
</tr>
<tr>
<td class="address-1"><span id="32301"></span>32301</td>
<td class="instruction">DEC D</td>
</tr>
<tr>
<td class="address-1"><span id="32302"></span>32302</td>
<td class="instruction">JR NZ,32298</td>
</tr>
<tr>
<td class="address-2"><span id="32304"></span>32304</td>
<td class="instruction">AND 7</td>
<td class="comment-1" rowspan="1">0&lt;=<span class="register">A</span>&lt;=7</td>
</tr>
<tr>
<td class="address-1"><span id="32306"></span>32306</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=border colour for this note</td>
</tr>
<tr>
<td class="address-1"><span id="32307"></span>32307</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="4">Point <span class="register">HL</span> at the appropriate entry in the note pitch/duration data table at <a href="32263.html">32263</a></td>
</tr>
<tr>
<td class="address-1"><span id="32308"></span>32308</td>
<td class="instruction">ADD A,7</td>
</tr>
<tr>
<td class="address-1"><span id="32310"></span>32310</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="32311"></span>32311</td>
<td class="instruction">LD H,126</td>
</tr>
<tr>
<td class="address-1"><span id="32313"></span>32313</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=original tune datum</td>
</tr>
<tr>
<td class="address-1"><span id="32314"></span>32314</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="15">Obtain the note frequency parameter in <span class="register">E</span> and the note duration parameter in <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="32315"></span>32315</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32316"></span>32316</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32317"></span>32317</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32318"></span>32318</td>
<td class="instruction">AND 15</td>
</tr>
<tr>
<td class="address-1"><span id="32320"></span>32320</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="32321"></span>32321</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32322"></span>32322</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="32323"></span>32323</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32324"></span>32324</td>
<td class="instruction">LD HL,0</td>
</tr>
<tr>
<td class="address-2"><span id="32327"></span>32327</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="32328"></span>32328</td>
<td class="instruction">DJNZ 32327</td>
</tr>
<tr>
<td class="address-1"><span id="32330"></span>32330</td>
<td class="instruction">RR H</td>
</tr>
<tr>
<td class="address-1"><span id="32332"></span>32332</td>
<td class="instruction">RR L</td>
</tr>
<tr>
<td class="address-1"><span id="32334"></span>32334</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-2"><span id="32335"></span>32335</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="10">Produce a note</td>
</tr>
<tr>
<td class="address-1"><span id="32336"></span>32336</td>
<td class="instruction">OUT (254),A</td>
</tr>
<tr>
<td class="address-1"><span id="32338"></span>32338</td>
<td class="instruction">XOR 16</td>
</tr>
<tr>
<td class="address-1"><span id="32340"></span>32340</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address-1"><span id="32341"></span>32341</td>
<td class="instruction">LD B,E</td>
</tr>
<tr>
<td class="address-2"><span id="32342"></span>32342</td>
<td class="instruction">DJNZ 32342</td>
</tr>
<tr>
<td class="address-1"><span id="32344"></span>32344</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="32345"></span>32345</td>
<td class="instruction">LD A,H</td>
</tr>
<tr>
<td class="address-1"><span id="32346"></span>32346</td>
<td class="instruction">OR L</td>
</tr>
<tr>
<td class="address-1"><span id="32347"></span>32347</td>
<td class="instruction">JR NZ,32335</td>
</tr>
<tr>
<td class="address-1"><span id="32349"></span>32349</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the pointer to the tune data table</td>
</tr>
<tr>
<td class="address-1"><span id="32350"></span>32350</td>
<td class="instruction">JP 32280</td>
<td class="comment-1" rowspan="1">Pick up the next tune datum</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32263.html">32263</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32279">Map</a></td>
<td class="next">
Next: <a href="32353.html">32353</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/7E17.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>