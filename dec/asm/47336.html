<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at 47336</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Skool Daze" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="47231.html">47231</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47336">Map</a></td>
<td class="next">
Next: <a href="47358.html">47358</a>
</td>
</tr>
</table>
<div class="description">47336: Change a character's name (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from <a href="47208.html">47208</a>. Returns with the zero flag set if 'c' was pressed after entering the character's name.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address of the character's name message</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">23611 (FLAGS)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="47336"></span>47336</td>
<td class="instruction">RES 5,(HL)</td>
<td class="comment-1" rowspan="1">Signal: no key pressed</td>
</tr>
<tr>
<td class="address-1"><span id="47338"></span>47338</td>
<td class="instruction">LD H,D</td>
<td class="comment-1" rowspan="2">Set <span class="register">HL</span> to the message address for the character's name</td>
</tr>
<tr>
<td class="address-1"><span id="47339"></span>47339</td>
<td class="instruction">LD L,E</td>
</tr>
<tr>
<td class="address-2"><span id="47340"></span>47340</td>
<td class="instruction">CALL <a href="47080.html">47080</a></td>
<td class="comment-1" rowspan="1">Collect a keypress</td>
</tr>
<tr>
<td class="address-1"><span id="47343"></span>47343</td>
<td class="instruction">JR Z,47352</td>
<td class="comment-1" rowspan="1">Jump forward if ENTER was pressed</td>
</tr>
<tr>
<td class="address-1"><span id="47345"></span>47345</td>
<td class="instruction">CP 13</td>
<td class="comment-1" rowspan="1">Have 13 characters been typed?</td>
</tr>
<tr>
<td class="address-1"><span id="47347"></span>47347</td>
<td class="instruction">JR NZ,47340</td>
<td class="comment-1" rowspan="1">Jump back to collect another keypress if not</td>
</tr>
<tr>
<td class="address-1"><span id="47349"></span>47349</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="2">Set the character name message address offset back to 12 to avoid overflow (any subsequent keypresses will be stored at that offset)</td>
</tr>
<tr>
<td class="address-1"><span id="47350"></span>47350</td>
<td class="instruction">JR 47340</td>
</tr>
<tr>
<td class="address-2"><span id="47352"></span>47352</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the message address</td>
</tr>
<tr>
<td class="address-1"><span id="47353"></span>47353</td>
<td class="instruction">CALL <a href="46824.html">46824</a></td>
<td class="comment-1" rowspan="1">Print 'PRESS'C'TO CHANGE NAME' and wait for a keypress</td>
</tr>
<tr>
<td class="address-1"><span id="47356"></span>47356</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the character name message address to <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="47357"></span>47357</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="47231.html">47231</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47336">Map</a></td>
<td class="next">
Next: <a href="47358.html">47358</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze RAM disassembly 20210310</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
<div><a href="../../asm/B8E8.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>